import{_ as U,a5 as p,o as c,a as o,b as t,w as a,Q as h,e as f,d as v,a1 as n,t as r,aq as k,f as m,a6 as V,a7 as I,Z as F,c as b,h as D,a4 as C,ar as P}from"./index-lPAR6Jhh.js";import{Q as g,a as u}from"./QMenu-B-B1QStO.js";import{Q as _,a as S}from"./QItemLabel-nqG76Yrv.js";import{Q as E}from"./QSelect-CbWjc70L.js";import{Q as T,C as x}from"./ClosePopup-IDxrIBrB.js";import{Q as N}from"./QMarkupTable-CioHdnf4.js";import{Q as y}from"./QSpace-CQPUmHlq.js";import{Q}from"./QImg-D1sKr7CE.js";import{Q as A}from"./QTooltip-DBefQNLx.js";import{Q as B}from"./QForm-BUxmvV0f.js";import{Q as z}from"./QPage-DE3LyCWt.js";import{h as q}from"./moment-C5S46NFB.js";import{I as G}from"./Imprimir--3wAIWou.js";import{E as L}from"./Excel-7RYvmDfo.js";import"./rtl-DFPa-2ov.js";import"./format-BvkBI9bc.js";import"./_commonjsHelpers-gnU0ypJ3.js";const Y={data(){return{compras:[],fechaInicio:q().format("YYYY-MM-DD"),fechaFin:q().format("YYYY-MM-DD"),user:"",users:[],loading:!1,verDatosDialog:!1,compraSeleccionada:null,fotoDialog:!1,fotoDialogUrl:"",editarDialog:!1,editarCompra:{id:null,nro_factura:"",facturado:!1,foto:""},editarFotoFile:null,editarFotoName:"",editarFotoPreview:"",removeFoto:!1}},mounted(){this.comprasGet(),this.usersGet()},computed:{usersTodos(){return[{label:"Todos",value:""},...this.users.map(i=>({label:i.name,value:i.id}))]},totalCompras(){return this.compras.reduce((i,e)=>e.estado==="Activo"?i+parseFloat(e.total):i,0).toFixed(2)},totalAnuladas(){return this.compras.reduce((i,e)=>e.estado==="Anulado"?i+parseFloat(e.total):i,0).toFixed(2)}},methods:{imageUrl(i){return i?`${this.$url}../${i}`:""},verDatos(i){this.compraSeleccionada=i,this.verDatosDialog=!0},openEditar(i){this.editarCompra={id:i.id,nro_factura:i.nro_factura||"",facturado:!!i.facturado,foto:i.foto||""},this.editarFotoFile=null,this.editarFotoName="",this.editarFotoPreview="",this.removeFoto=!1,this.editarDialog=!0},onEditarFotoChange(i){const e=i.target.files?.[0];this.editarFotoFile=e||null,this.editarFotoName=e?e.name:"",this.removeFoto=!1,this.editarFotoPreview&&URL.revokeObjectURL(this.editarFotoPreview),this.editarFotoPreview=e?URL.createObjectURL(e):""},quitarFotoEdicion(){this.editarFotoFile=null,this.editarFotoName="",this.editarFotoPreview&&URL.revokeObjectURL(this.editarFotoPreview),this.editarFotoPreview="",this.editarCompra.foto="",this.removeFoto=!0},guardarEdicionCompra(){if(!this.editarCompra.id)return;this.loading=!0;const i=new FormData;i.append("_method","PUT"),i.append("nro_factura",this.editarCompra.nro_factura||""),i.append("facturado",this.editarCompra.facturado?"1":"0"),this.editarFotoFile&&i.append("foto",this.editarFotoFile),this.removeFoto&&i.append("remove_foto","1"),this.$axios.post(`compras/${this.editarCompra.id}/datos`,i,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{this.$alert.success("Datos de compra actualizados"),this.editarDialog=!1,this.comprasGet()}).catch(e=>{this.$alert.error(e.response?.data?.message||"No se pudo actualizar la compra")}).finally(()=>{this.loading=!1})},openFoto(i,e=!1){this.fotoDialogUrl=e?i:this.imageUrl(i),this.fotoDialog=!0},excel(){const i=[{columns:[{label:"ID",value:"id"},{label:"Fecha",value:e=>e.fecha_hora||`${e.fecha} ${e.hora}`},{label:"Proveedor",value:e=>e.proveedor?.nombre||e.nombre||""},{label:"Usuario",value:e=>e.user?.name||""},{label:"Estado",value:"estado"},{label:"Total (Bs)",value:"total"},{label:"Detalle",value:"detailsText"},{label:"Tipo de pago",value:"tipo_pago"},{label:"Factura",value:"nro_factura"}],content:this.compras}];L.export(i,`Compras_${this.fechaInicio}_a_${this.fechaFin}`)},comprasGet(){this.loading=!0,this.$axios.get("compras",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user}}).then(i=>{this.compras=i.data}).catch(i=>{this.$alert.error(i.response?.data?.message||"Error al obtener compras")}).finally(()=>{this.loading=!1})},usersGet(){this.$axios.get("users").then(i=>{console.log(i.data),this.users=i.data})},imprimir(i){G.reciboCompra(i)},anular(i){this.$alert.dialog("Â¿Anular esta compra?").onOk(()=>{this.loading=!0,this.$axios.put(`comprasAnular/${i}`).then(()=>{this.$alert.success("Compra anulada"),this.comprasGet()})})}}},O={class:"row"},R={class:"col-12 col-md-4 q-pa-xs"},M={class:"col-12 col-md-4 q-pa-xs"},j={class:"col-12 col-md-4 q-pa-xs"},Z={class:"row q-col-gutter-sm q-pa-sm"},H={class:"col-12 col-md-2"},J={class:"col-12 col-md-2"},K={class:"col-12 col-md-2"},W={class:"col-12 col-md-2"},X={class:"col-12 col-md-2"},$={class:"col-12 col-md-2"},ee={class:"text-bold"},oe={style:{"max-width":"200px","line-height":"1.1"}},te={class:"text-h6"},le={class:"row q-col-gutter-sm"},ae={class:"col-12 col-md-6"},ie={class:"col-12 col-md-6"},se={class:"col-12 col-md-6"},re={class:"col-12 col-md-6"},ne={class:"col-12 col-md-6"},de={class:"col-12 col-md-6"},ue={class:"col-12 col-md-6"},ce={class:"col-12 col-md-6"},me={class:"col-12"},fe={key:0},pe={key:1,class:"text-grey-7"},he={class:"text-h6"},ve={class:"q-mb-sm"},ge={class:"q-mb-sm"},_e={key:0,class:"text-caption q-mt-xs"},be={key:0},Fe={key:1,class:"q-mt-sm"},Ce={class:"text-right q-mt-md"};function xe(i,e,we,ke,l,d){return c(),p(V,null,[o(z,{class:"q-pa-xs"},{default:a(()=>[t("div",O,[t("div",R,[o(h,{flat:"",bordered:""},{default:a(()=>[o(f,{class:"q-pa-none"},{default:a(()=>[o(g,{class:"bg-green"},{default:a(()=>[o(u,{avatar:""},{default:a(()=>[o(v,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),o(u,null,{default:a(()=>[o(_,{caption:"",class:"text-white"},{default:a(()=>e[17]||(e[17]=[n("Compras Totales")])),_:1}),o(_,{class:"text-white text-h4"},{default:a(()=>[n(r(d.totalCompras)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),t("div",M,[o(h,{flat:"",bordered:""},{default:a(()=>[o(f,{class:"q-pa-none"},{default:a(()=>[o(g,{class:"bg-negative"},{default:a(()=>[o(u,{avatar:""},{default:a(()=>[o(v,{name:"cancel",size:"50px",color:"white"})]),_:1}),o(u,null,{default:a(()=>[o(_,{caption:"",class:"text-white"},{default:a(()=>e[18]||(e[18]=[n("Compras Anuladas")])),_:1}),o(_,{class:"text-white text-h4"},{default:a(()=>[n(r(d.totalAnuladas)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),t("div",j,[o(h,{flat:"",bordered:""},{default:a(()=>[o(f,{class:"q-pa-none"},{default:a(()=>[o(g,{class:"bg-indigo"},{default:a(()=>[o(u,{avatar:""},{default:a(()=>[o(v,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),o(u,null,{default:a(()=>[o(_,{caption:"",class:"text-white"},{default:a(()=>e[19]||(e[19]=[n("Total Compras")])),_:1}),o(_,{class:"text-white text-h4"},{default:a(()=>[n(r(l.compras.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),o(h,{flat:"",bordered:"",class:"q-mt-sm"},{default:a(()=>[o(f,{class:"q-pa-none"},{default:a(()=>[t("div",Z,[t("div",H,[o(k,{modelValue:l.fechaInicio,"onUpdate:modelValue":e[0]||(e[0]=s=>l.fechaInicio=s),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),t("div",J,[o(k,{modelValue:l.fechaFin,"onUpdate:modelValue":e[1]||(e[1]=s=>l.fechaFin=s),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),t("div",K,[o(E,{modelValue:l.user,"onUpdate:modelValue":e[2]||(e[2]=s=>l.user=s),options:d.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),t("div",W,[o(m,{color:"primary",label:"Buscar",icon:"search",onClick:d.comprasGet,loading:l.loading,"no-caps":""},null,8,["onClick","loading"])]),t("div",X,[o(m,{color:"positive",label:"Compra",icon:"add_circle_outline",onClick:e[3]||(e[3]=s=>i.$router.push({name:"compras-create"})),"no-caps":"",loading:l.loading},null,8,["loading"])]),t("div",$,[o(m,{color:"primary",label:"Excel",icon:"file_download",onClick:d.excel,"no-caps":"",loading:l.loading},null,8,["onClick","loading"])])])]),_:1})]),_:1}),o(N,{dense:"","wrap-cells":""},{default:a(()=>[e[24]||(e[24]=t("thead",null,[t("tr",{class:"bg-primary text-white"},[t("th",null,"Acciones"),t("th",null,"ID"),t("th",null,"Fecha"),t("th",null,"Factura"),t("th",null,"Proveedor"),t("th",null,"Usuario"),t("th",null,"Estado"),t("th",null,"Total"),t("th",null,"Detalle"),t("th",null,"Pago")])],-1)),t("tbody",null,[(c(!0),p(V,null,I(l.compras,s=>(c(),p("tr",{key:s.id},[t("td",null,[o(T,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:a(()=>[F((c(),b(g,{clickable:"",onClick:w=>d.imprimir(s)},{default:a(()=>[o(u,{avatar:""},{default:a(()=>[o(v,{name:"print"})]),_:1}),o(u,null,{default:a(()=>e[20]||(e[20]=[n("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[x]]),F((c(),b(g,{clickable:"",onClick:w=>d.verDatos(s)},{default:a(()=>[o(u,{avatar:""},{default:a(()=>[o(v,{name:"visibility"})]),_:1}),o(u,null,{default:a(()=>e[21]||(e[21]=[n("Ver datos")])),_:1})]),_:2},1032,["onClick"])),[[x]]),F((c(),b(g,{clickable:"",onClick:w=>d.openEditar(s)},{default:a(()=>[o(u,{avatar:""},{default:a(()=>[o(v,{name:"edit"})]),_:1}),o(u,null,{default:a(()=>e[22]||(e[22]=[n("Actualizar datos")])),_:1})]),_:2},1032,["onClick"])),[[x]]),F((c(),b(g,{clickable:"",onClick:w=>d.anular(s.id)},{default:a(()=>[o(u,{avatar:""},{default:a(()=>[o(v,{name:"delete"})]),_:1}),o(u,null,{default:a(()=>e[23]||(e[23]=[n("Anular")])),_:1})]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)]),t("td",null,r(s.id),1),t("td",null,r(s.fecha_hora||s.fecha+" "+s.hora),1),t("td",null,r(s.nro_factura),1),t("td",null,r(s.proveedor?.nombre),1),t("td",null,r(s.user?.name),1),t("td",null,[o(S,{color:s.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:a(()=>[n(r(s.estado),1)]),_:2},1032,["color"])]),t("td",ee,r(s.total)+" Bs",1),t("td",null,[t("div",oe,r(s.detailsText),1)]),t("td",null,[o(S,{color:s.tipo_pago==="Efectivo"?"green":"blue",class:"text-white",dense:""},{default:a(()=>[n(r(s.tipo_pago),1)]),_:2},1032,["color"])])]))),128))])]),_:1}),o(D,{modelValue:l.verDatosDialog,"onUpdate:modelValue":e[6]||(e[6]=s=>l.verDatosDialog=s)},{default:a(()=>[o(h,{style:{width:"700px","max-width":"95vw"}},{default:a(()=>[o(f,{class:"row items-center q-pb-none"},{default:a(()=>[t("div",te,"Datos de compra #"+r(l.compraSeleccionada?.id),1),o(y),o(m,{flat:"",round:"",dense:"",icon:"close",onClick:e[4]||(e[4]=s=>l.verDatosDialog=!1)})]),_:1}),l.compraSeleccionada?(c(),b(f,{key:0},{default:a(()=>[t("div",le,[t("div",ae,[e[25]||(e[25]=t("b",null,"Fecha:",-1)),n(" "+r(l.compraSeleccionada.fecha_hora||l.compraSeleccionada.fecha+" "+l.compraSeleccionada.hora),1)]),t("div",ie,[e[26]||(e[26]=t("b",null,"Proveedor:",-1)),n(" "+r(l.compraSeleccionada.proveedor?.nombre||l.compraSeleccionada.nombre||"-"),1)]),t("div",se,[e[27]||(e[27]=t("b",null,"CI:",-1)),n(" "+r(l.compraSeleccionada.ci||"-"),1)]),t("div",re,[e[28]||(e[28]=t("b",null,"Pago:",-1)),n(" "+r(l.compraSeleccionada.tipo_pago||"-"),1)]),t("div",ne,[e[29]||(e[29]=t("b",null,"Factura Nro:",-1)),n(" "+r(l.compraSeleccionada.nro_factura||"-"),1)]),t("div",de,[e[30]||(e[30]=t("b",null,"Facturado:",-1)),n(" "+r(l.compraSeleccionada.facturado?"SI":"NO"),1)]),t("div",ue,[e[31]||(e[31]=t("b",null,"Agencia:",-1)),n(" "+r(l.compraSeleccionada.agencia||"-"),1)]),t("div",ce,[e[32]||(e[32]=t("b",null,"Total:",-1)),n(" "+r(l.compraSeleccionada.total)+" Bs",1)]),t("div",me,[e[33]||(e[33]=t("div",{class:"text-subtitle2 q-mb-xs"},"Foto / Factura",-1)),l.compraSeleccionada.foto?(c(),p("div",fe,[o(Q,{src:d.imageUrl(l.compraSeleccionada.foto),style:{"max-width":"360px","border-radius":"8px",cursor:"pointer"},fit:"contain",onClick:e[5]||(e[5]=s=>d.openFoto(l.compraSeleccionada.foto))},null,8,["src"])])):(c(),p("div",pe,"Sin foto adjunta"))])])]),_:1})):C("",!0)]),_:1})]),_:1},8,["modelValue"]),o(D,{modelValue:l.fotoDialog,"onUpdate:modelValue":e[8]||(e[8]=s=>l.fotoDialog=s),maximized:""},{default:a(()=>[o(h,{style:{width:"100vw",height:"100vh"}},{default:a(()=>[o(f,{class:"row items-center q-pb-none"},{default:a(()=>[e[34]||(e[34]=t("div",{class:"text-subtitle1"},"Factura / Foto",-1)),o(y),o(m,{flat:"",round:"",dense:"",icon:"close",onClick:e[7]||(e[7]=s=>l.fotoDialog=!1)})]),_:1}),o(f,null,{default:a(()=>[o(Q,{src:l.fotoDialogUrl,style:{width:"100%",height:"calc(100vh - 90px)"},fit:"contain"},null,8,["src"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(D,{modelValue:l.editarDialog,"onUpdate:modelValue":e[16]||(e[16]=s=>l.editarDialog=s),persistent:""},{default:a(()=>[o(h,{style:{width:"520px","max-width":"95vw"}},{default:a(()=>[o(f,{class:"row items-center q-pb-none"},{default:a(()=>[t("div",he,"Actualizar datos compra #"+r(l.editarCompra.id||""),1),o(y),o(m,{flat:"",round:"",dense:"",icon:"close",onClick:e[9]||(e[9]=s=>l.editarDialog=!1)})]),_:1}),o(f,null,{default:a(()=>[o(B,{onSubmit:d.guardarEdicionCompra},{default:a(()=>[o(k,{modelValue:l.editarCompra.nro_factura,"onUpdate:modelValue":e[10]||(e[10]=s=>l.editarCompra.nro_factura=s),label:"Nro. factura",dense:"",outlined:"",class:"q-mb-sm"},null,8,["modelValue"]),t("div",ve,[o(P,{modelValue:l.editarCompra.facturado,"onUpdate:modelValue":e[11]||(e[11]=s=>l.editarCompra.facturado=s),label:"Facturado"},{default:a(()=>[o(A,null,{default:a(()=>[n(" Facturado: "+r(l.editarCompra.facturado?"Si":"No"),1)]),_:1})]),_:1},8,["modelValue"])]),t("div",ge,[o(m,{flat:"",color:"primary",icon:"photo_camera",label:"Cambiar foto","no-caps":"",onClick:e[12]||(e[12]=s=>i.$refs.editarFotoInput.click())}),t("input",{ref:"editarFotoInput",type:"file",accept:"image/*",style:{display:"none"},onChange:e[13]||(e[13]=(...s)=>d.onEditarFotoChange&&d.onEditarFotoChange(...s))},null,544),l.editarFotoName?(c(),p("div",_e,r(l.editarFotoName),1)):C("",!0)]),l.editarFotoPreview||l.editarCompra.foto?(c(),p("div",be,[o(Q,{src:l.editarFotoPreview||d.imageUrl(l.editarCompra.foto),style:{"max-width":"240px","border-radius":"8px"},fit:"contain"},null,8,["src"])])):C("",!0),l.editarFotoPreview||l.editarCompra.foto?(c(),p("div",Fe,[o(m,{flat:"",color:"primary",icon:"visibility",label:"Ver foto","no-caps":"",onClick:e[14]||(e[14]=s=>d.openFoto(l.editarFotoPreview||l.editarCompra.foto,!!l.editarFotoPreview))}),o(m,{flat:"",color:"negative",icon:"delete",label:"Quitar foto","no-caps":"",onClick:d.quitarFotoEdicion,class:"q-ml-sm"},null,8,["onClick"])])):C("",!0),t("div",Ce,[o(m,{flat:"",label:"Cancelar",color:"grey-8",onClick:e[15]||(e[15]=s=>l.editarDialog=!1),loading:l.loading},null,8,["loading"]),o(m,{color:"primary",label:"Guardar",type:"submit",class:"q-ml-sm",loading:l.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e[35]||(e[35]=t("div",{id:"myElement",class:"hidden"},null,-1))],64)}const Ye=U(Y,[["render",xe]]);export{Ye as default};
