import{_ as k,c as u,o as i,w as r,a as l,Q as f,e as g,b as e,t as o,f as c,a2 as m,a3 as h,a4 as F,a5 as _,a1 as C}from"./index-CmoW1HI-.js";import{Q as p}from"./QChip-B_XB_8XG.js";import{Q as b}from"./QMarkupTable-6CKuV8-r.js";import{Q as D}from"./QPage-Dl-a7fNa.js";const U={name:"ImpuestosPage",data(){return{loading:!1,cufds:[],fallas:[],estado:{hora_programada:"09:00",zona_horaria:"",cufd_actual:null,fallas_pendientes:0}}},mounted(){this.cargarTodo()},methods:{cargarTodo(){this.listCUFD(),this.listFallas(),this.estadoAuto()},estadoAuto(){this.$axios.get("impuestos/auto-cufd/estado").then(({data:a})=>{this.estado=a||this.estado}).catch(a=>{this.$alert.error(a.response?.data?.message||"Error al obtener estado automatico")})},listCUFD(){this.loading=!0,this.$axios.get("impuestos/list-cufd").then(a=>{this.cufds=a.data}).catch(a=>{this.$alert.error(a.response?.data?.message||"Error al listar CUFD")}).finally(()=>{this.loading=!1})},listFallas(){this.$axios.get("impuestos/fallas").then(({data:a})=>{this.fallas=a?.data||[]}).catch(a=>{this.$alert.error(a.response?.data?.message||"Error al listar fallas")})},generarCUI(){this.loading=!0,this.$axios.post("impuestos/generar-cui").then(()=>{this.$alert.success("CUI generado correctamente")}).catch(a=>{this.$alert.error(a.response?.data?.message||"Error al generar CUI")}).finally(()=>{this.loading=!1,this.cargarTodo()})},generarCUFD(){this.loading=!0,this.$axios.post("impuestos/generar-cufd").then(a=>{const t=a.data?.success||a.data?.message||"CUFD procesado correctamente";this.$alert.success(t)}).catch(a=>{this.$alert.error(a.response?.data?.message||"Error al generar CUFD")}).finally(()=>{this.loading=!1,this.cargarTodo()})},reintentarCUFD(){this.loading=!0,this.$axios.post("impuestos/reintentar-cufd").then(a=>{this.$alert.success(a.data?.message||"Reintento CUFD ejecutado")}).catch(a=>{this.$alert.error(a.response?.data?.message||"Error al reintentar CUFD")}).finally(()=>{this.loading=!1,this.cargarTodo()})},resolverFalla(a){this.$axios.put(`impuestos/fallas/${a.id}/resolver`).then(()=>{this.$alert.success("Falla resuelta"),this.cargarTodo()}).catch(t=>{this.$alert.error(t.response?.data?.message||"No se pudo resolver la falla")})},ocultarFalla(a){this.$axios.put(`impuestos/fallas/${a.id}/ocultar`).then(()=>{this.$alert.success("Falla ocultada"),this.cargarTodo()}).catch(t=>{this.$alert.error(t.response?.data?.message||"No se pudo ocultar la falla")})},eliminarFalla(a){this.$axios.delete(`impuestos/fallas/${a.id}`).then(()=>{this.$alert.success("Falla eliminada"),this.cargarTodo()}).catch(t=>{this.$alert.error(t.response?.data?.message||"No se pudo eliminar la falla")})}}},v={class:"col-12 col-md-6"},y={class:"text-caption text-grey-7"},$={class:"col-12 col-md-6 text-right"},q={style:{"max-width":"300px","white-space":"normal"}},w={key:0};function I(a,t,Q,T,n,d){return i(),u(D,{class:"q-pa-xs"},{default:r(()=>[l(f,{flat:"",bordered:"",class:"q-mb-sm"},{default:r(()=>[l(g,{class:"row items-center q-col-gutter-sm"},{default:r(()=>[e("div",v,[t[0]||(t[0]=e("div",{class:"text-h6"},"Impuestos - Ajustes CUFD",-1)),e("div",y," Programado diariamente a las "+o(n.estado.hora_programada||"09:00")+" ("+o(n.estado.zona_horaria||"-")+") ",1)]),e("div",$,[l(c,{color:"primary",label:"Generar CUI",icon:"add","no-caps":"",onClick:d.generarCUI,loading:n.loading},null,8,["onClick","loading"]),l(c,{color:"secondary",label:"Generar CUFD",icon:"add","no-caps":"",class:"q-ml-sm",onClick:d.generarCUFD,loading:n.loading},null,8,["onClick","loading"]),l(c,{color:"orange",label:"Reintentar CUFD",icon:"refresh","no-caps":"",class:"q-ml-sm",onClick:d.reintentarCUFD,loading:n.loading},null,8,["onClick","loading"])])]),_:1}),l(g,{class:"q-pt-none"},{default:r(()=>[l(p,{color:"negative","text-color":"white",class:"q-mr-sm"},{default:r(()=>[m(" Fallas pendientes: "+o(n.estado.fallas_pendientes||0),1)]),_:1}),n.estado.cufd_actual?(i(),u(p,{key:0,color:"green","text-color":"white"},{default:r(()=>[m(" CUFD vigente ID: "+o(n.estado.cufd_actual.id),1)]),_:1})):(i(),u(p,{key:1,color:"orange","text-color":"white"},{default:r(()=>t[1]||(t[1]=[m(" Sin CUFD vigente ")])),_:1}))]),_:1})]),_:1}),l(f,{flat:"",bordered:"",class:"q-mb-sm"},{default:r(()=>[l(g,{class:"q-pa-xs"},{default:r(()=>[t[3]||(t[3]=e("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Historial CUFD",-1)),l(b,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:r(()=>[t[2]||(t[2]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Codigo Control"),e("th",null,"Fecha Vigencia"),e("th",null,"Fecha Creacion")])],-1)),e("tbody",null,[(i(!0),h(F,null,_(n.cufds,s=>(i(),h("tr",{key:s.id},[e("td",null,o(s.id),1),e("td",null,o(s.codigoControl),1),e("td",null,o(s.fechaVigencia),1),e("td",null,o(s.fechaCreacion),1)]))),128))])]),_:1})]),_:1})]),_:1}),l(f,{flat:"",bordered:""},{default:r(()=>[l(g,{class:"q-pa-xs"},{default:r(()=>[t[6]||(t[6]=e("div",{class:"text-subtitle1 text-weight-bold q-mb-sm"},"Fallas de generacion CUFD",-1)),l(b,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:r(()=>[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Estado"),e("th",null,"Mensaje"),e("th",null,"Detalle"),e("th",null,"Fecha"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(i(!0),h(F,null,_(n.fallas,s=>(i(),h("tr",{key:s.id},[e("td",null,o(s.id),1),e("td",null,[l(p,{dense:"",color:s.estado==="pendiente"?"negative":s.estado==="resuelto"?"green":"grey","text-color":"white"},{default:r(()=>[m(o(s.estado),1)]),_:2},1032,["color"])]),e("td",null,o(s.mensaje),1),e("td",q,o(s.detalle?.error||"-"),1),e("td",null,o(s.fecha_evento),1),e("td",null,[s.estado==="pendiente"?(i(),u(c,{key:0,size:"xs",color:"green",flat:"","no-caps":"",label:"Resolver",class:"q-mr-xs",onClick:x=>d.resolverFalla(s)},null,8,["onClick"])):C("",!0),s.estado==="pendiente"?(i(),u(c,{key:1,size:"xs",color:"orange",flat:"","no-caps":"",label:"Ocultar",class:"q-mr-xs",onClick:x=>d.ocultarFalla(s)},null,8,["onClick"])):C("",!0),l(c,{size:"xs",color:"negative",flat:"","no-caps":"",label:"Borrar",onClick:x=>d.eliminarFalla(s)},null,8,["onClick"])])]))),128)),n.fallas.length===0?(i(),h("tr",w,t[4]||(t[4]=[e("td",{colspan:"6",class:"text-center text-grey-7"},"Sin fallas registradas",-1)]))):C("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})}const z=k(U,[["render",I]]);export{z as default};
