import{_ as j,g as M,r as h,l as z,c as Q,o as i,w as d,a as n,Q as S,e as q,b as e,aa as D,f as _,a2 as b,t as o,a3 as m,a1 as U,a4 as k,a5 as $}from"./index-CmoW1HI-.js";import{Q as g}from"./QChip-B_XB_8XG.js";import{Q as F}from"./QMarkupTable-6CKuV8-r.js";import{Q as A}from"./QPage-Dl-a7fNa.js";const W={class:"col-12 col-md-2"},H={class:"col-12 col-md-2"},G={class:"col-12 col-md-3"},J={class:"col-12 col-md-5"},K={class:"col-6 col-md-3"},X={class:"col-6 col-md-3"},Y={class:"col-6 col-md-3"},Z={class:"col-6 col-md-3"},ee={style:{"white-space":"nowrap"}},te={key:0},ae={colspan:"9"},oe={class:"text-subtitle2 q-mt-sm"},le={key:0},ne={__name:"DespachoCamion",setup(se){const{proxy:r}=M(),V=new Date().toISOString().slice(0,10),y=h(V),x=h(V),N=h(!1),B=h(!1),w=h([]),v=h({}),C=h({});function I(s){C.value[s]=!C.value[s]}async function L(){N.value=!0;try{const s=await r.$axios.get("/despachador/despacho",{params:{fecha_inicio:y.value,fecha_fin:x.value}});w.value=Array.isArray(s.data?.data)?s.data.data:[],v.value=s.data?.stats||{},C.value={}}catch(s){r.$alert.error(s?.response?.data?.message||"No se pudo cargar despacho")}finally{N.value=!1}}async function O(s,a){a.value=!0;try{const t=await r.$axios.get(s,{params:{fecha_inicio:y.value,fecha_fin:x.value},responseType:"blob"}),l=new Blob([t.data],{type:"application/pdf"}),c=(t?.headers?.["content-disposition"]||"").match(/filename="?([^"]+)"?/)?.[1]||"vouchers_despacho.pdf",p=document.createElement("a"),R=window.URL.createObjectURL(l);p.href=R,p.download=c,document.body.appendChild(p),p.click(),p.remove(),window.URL.revokeObjectURL(R)}catch(t){r.$alert.error(t?.response?.data?.message||"No se pudo generar el PDF")}finally{a.value=!1}}async function T(){await O("/despachador/reportes/vouchers",B)}async function E(s){try{const a=await r.$axios.get(`/despachador/reportes/vouchers/${s.venta_id}`,{responseType:"blob"}),t=new Blob([a.data],{type:"application/pdf"}),u=(a?.headers?.["content-disposition"]||"").match(/filename="?([^"]+)"?/)?.[1]||`voucher_venta_${s.venta_id}.pdf`,c=document.createElement("a"),p=window.URL.createObjectURL(t);c.href=p,c.download=u,document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(p)}catch(a){r.$alert.error(a?.response?.data?.message||"No se pudo generar el voucher")}}async function P(s){try{const a=await r.$axios.get(`/despachador/reportes/vouchers/${s.venta_id}`,{responseType:"blob"}),t=new Blob([a.data],{type:"application/pdf"}),l=`voucher_venta_${s.venta_id}.pdf`,f=new File([t],l,{type:"application/pdf"});if(navigator.canShare&&navigator.canShare({files:[f]})){await navigator.share({files:[f],title:l});return}const u=document.createElement("a"),c=window.URL.createObjectURL(t);u.href=c,u.download=l,document.body.appendChild(u),u.click(),u.remove(),window.URL.revokeObjectURL(c),r.$alert.error("Tu navegador no permite compartir PDF directo. Se descargÃ³ el voucher.")}catch(a){r.$alert.error(a?.response?.data?.message||"No se pudo preparar el voucher")}}return z(L),(s,a)=>(i(),Q(A,{class:"q-pa-sm despacho-page"},{default:d(()=>[n(S,{flat:"",bordered:"",class:"q-mb-sm"},{default:d(()=>[n(q,{class:"row q-col-gutter-sm items-center"},{default:d(()=>[e("div",W,[n(D,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=t=>y.value=t),dense:"",outlined:"",type:"date",label:"Fecha inicio"},null,8,["modelValue"])]),e("div",H,[n(D,{modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=t=>x.value=t),dense:"",outlined:"",type:"date",label:"Fecha fin"},null,8,["modelValue"])]),e("div",G,[n(_,{color:"primary",icon:"search","no-caps":"",class:"full-width",label:"Consultar despacho",loading:N.value,onClick:L},null,8,["loading"])]),e("div",J,[n(_,{color:"teal",icon:"print","no-caps":"",class:"full-width text-weight-bold",label:"Imprimir vouchers del rango",loading:B.value,onClick:T},null,8,["loading"])])]),_:1}),n(q,{class:"row q-col-gutter-sm q-pt-none"},{default:d(()=>[e("div",K,[n(g,{color:"blue-8","text-color":"white"},{default:d(()=>[b("Comandas: "+o(v.value.total_entregas||0),1)]),_:1})]),e("div",X,[n(g,{color:"green-8","text-color":"white"},{default:d(()=>[b("Cobrado: "+o(Number(v.value.monto_cobrado||0).toFixed(2))+" Bs",1)]),_:1})]),e("div",Y,[n(g,{color:"indigo-8","text-color":"white"},{default:d(()=>[b("Contado: "+o(Number(v.value.contado||0).toFixed(2))+" Bs",1)]),_:1})]),e("div",Z,[n(g,{color:"orange-8","text-color":"white"},{default:d(()=>[b("Saldo: "+o(Number(v.value.saldo_total||0).toFixed(2))+" Bs",1)]),_:1})])]),_:1})]),_:1}),n(S,{flat:"",bordered:""},{default:d(()=>[n(F,{flat:"",dense:"","wrap-cells":""},{default:d(()=>[a[5]||(a[5]=e("thead",null,[e("tr",{class:"bg-grey-2"},[e("th",null,"Op"),e("th",null,"CINIT"),e("th",null,"Cliente"),e("th",null,"Comanda"),e("th",null,"Importe"),e("th",null,"Cobrado"),e("th",null,"Placa"),e("th",null,"Despachador"),e("th",null,"Tipo pago"),e("th",null,"Estado")])],-1)),e("tbody",null,[(i(!0),m(k,null,$(w.value,t=>(i(),m(k,{key:t.pedido_id},[e("tr",null,[e("td",ee,[n(_,{dense:"",size:"sm",color:"primary","no-caps":"",icon:"visibility",label:"Ver",class:"q-mr-xs",onClick:l=>I(t.pedido_id)},null,8,["onClick"]),n(_,{dense:"",size:"sm",color:"teal","no-caps":"",icon:"description",label:"Voucher",disable:!t.venta_id,onClick:l=>E(t)},null,8,["disable","onClick"]),n(_,{dense:"",size:"sm",color:"indigo","no-caps":"",icon:"chat",label:"WhatsApp",class:"q-ml-xs",disable:!t.venta_id,onClick:l=>P(t)},null,8,["disable","onClick"])]),e("td",null,o(t.ci||"-"),1),e("td",null,o(t.cliente||"-"),1),e("td",null,o(t.comanda||"-"),1),e("td",null,o(Number(t.total||0).toFixed(2)),1),e("td",null,o(Number(t.pagado||0).toFixed(2)),1),e("td",null,o(t.placa||"-"),1),e("td",null,o(t.camion||"-"),1),e("td",null,[n(g,{dense:"",color:String(t.tipo_pago||"").toUpperCase().includes("CRED")?"orange-8":"red","text-color":"white"},{default:d(()=>[b(o(t.tipo_pago||"-"),1)]),_:2},1032,["color"])]),e("td",null,o(t.despacho_estado||"-"),1)]),C.value[t.pedido_id]?(i(),m("tr",te,[e("td",ae,[n(F,{dense:"",flat:"",bordered:""},{default:d(()=>[a[2]||(a[2]=e("thead",null,[e("tr",null,[e("th",null,"Codigo"),e("th",null,"Producto"),e("th",null,"Cantidad")])],-1)),e("tbody",null,[(i(!0),m(k,null,$(t.productos||[],(l,f)=>(i(),m("tr",{key:`${t.pedido_id}-d-${f}`},[e("td",null,o(l.codigo||"-"),1),e("td",null,o(l.nombre||"-"),1),e("td",null,o(Number(l.cantidad||0).toFixed(2)),1)]))),128))])]),_:2},1024),e("div",oe," Cobrado: "+o(Number(t.pagado||0).toFixed(2))+" Bs | Saldo: "+o(Number(t.saldo||0).toFixed(2))+" Bs ",1),(t.pagos||[]).length?(i(),Q(F,{key:0,dense:"",flat:"",bordered:"",class:"q-mt-xs"},{default:d(()=>[a[3]||(a[3]=e("thead",null,[e("tr",null,[e("th",null,"Fecha/Hora"),e("th",null,"Monto"),e("th",null,"Metodo"),e("th",null,"Tipo"),e("th",null,"Registrado por"),e("th",null,"Obs.")])],-1)),e("tbody",null,[(i(!0),m(k,null,$(t.pagos,l=>(i(),m("tr",{key:l.id},[e("td",null,o(l.fecha_hora),1),e("td",null,o(Number(l.monto||0).toFixed(2)),1),e("td",null,o(l.metodo_pago),1),e("td",null,o(l.tipo_pago),1),e("td",null,o(l.registrado_por||"-"),1),e("td",null,o(l.observacion||"-"),1)]))),128))])]),_:2},1024)):U("",!0)])])):U("",!0)],64))),128)),w.value.length===0?(i(),m("tr",le,a[4]||(a[4]=[e("td",{colspan:"9",class:"text-center text-grey-7"},"Sin registros",-1)]))):U("",!0)])]),_:1})]),_:1})]),_:1}))}},ue=j(ne,[["__scopeId","data-v-9ee7ab57"]]);export{ue as default};
