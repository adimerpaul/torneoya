import{_ as G,c as R,o as b,w as a,a as t,Q as y,b as i,f as p,e as v,aa as s,d as A,a2 as g,t as u,a3 as V,a4 as T,a5 as L,a9 as q,h as D,Z as E,ac as O,as as F,ab as Z,ad as K,ae as H,a8 as S,a1 as J,a7 as z,aq as j}from"./index-CmoW1HI-.js";import{Q as P}from"./QChip-B_XB_8XG.js";import{Q as M}from"./QMarkupTable-6CKuV8-r.js";import{Q as k}from"./QSpace-CghvMLQs.js";import{Q as h}from"./QSelect-YWvpHr97.js";import{Q as w}from"./QImg-BFhzNBj4.js";import{a as x,b as C}from"./QMenu-j9-YnpjT.js";import{Q as Y}from"./QItemLabel-BiiYZsTs.js";import{Q as W}from"./QList-MksEbVq0.js";import{C as U,Q as X}from"./ClosePopup-veQafRnd.js";import{Q as $}from"./QPage-Dl-a7fNa.js";import{L as f}from"./leaflet-PeQDVTDL.js";import{m as ee,a as le,b as oe}from"./marker-shadow-Cv-YfD74.js";import"./format-CJebrXOQ.js";import"./_commonjsHelpers-Bx2EM-6T.js";f.Icon.Default.mergeOptions({iconRetinaUrl:oe,iconUrl:le,shadowUrl:ee});const te=[-17.967,-67.106],ie=["do","lu","ma","mi","ju","vi","sa"],de=["POLLO","RES","CERDO"],se={name:"VisitasPage",data(){return{loading:!1,loadingPedido:!1,loadingAccion:"",map:null,markersLayer:null,meMarker:null,search:"",showAllDays:!1,clientes:[],visitasByCliente:{},selectedCliente:null,comentario:"",dialogAcciones:!1,dialogPedido:!1,tiposPago:[{label:"Contado",value:"Contado"},{label:"Pago QR",value:"QR"},{label:"Credito",value:"Credito"},{label:"Boleta anterior",value:"Boleta anterior"}],tipoPago:"Contado",facturadoPedido:!1,fechaPedido:new Date().toISOString().slice(0,10),horariosPedido:[{label:"Sin horario",value:null},{label:"06:00-07:30",value:"06:00-07:30"},{label:"07:30-09:00",value:"07:30-09:00"},{label:"09:00-10:30",value:"09:00-10:30"},{label:"10:30-12:00",value:"10:30-12:00"},{label:"SEGUNDA VUELTA",value:"SEGUNDA VUELTA"},{label:"SE RECOGE",value:"SE RECOGE"}],horaPedido:null,productos:[],productosSource:[],productoSeleccionado:null,pedidoItems:[],dialogDetalle:!1,detalleEditIndex:-1,detalleEdit:{},detalleTipo:"NORMAL",unidadesPollo:["KG","CAJA","UNIDAD"],isAlive:!0}},computed:{dayCode(){return ie[new Date().getDay()]},dayLabel(){return{lu:"Lunes",ma:"Martes",mi:"Miercoles",ju:"Jueves",vi:"Viernes",sa:"Sabado",do:"Domingo"}[this.dayCode]},totalPedido(){return this.pedidoItems.reduce((d,e)=>d+Number(e.cantidad)*Number(e.precio),0)},clientesOrdenados(){const d={ACTIVO:1,RETORNAR:2,NO_PEDIDO:3,REALIZAR_PEDIDO:4};return[...this.clientes].sort((e,r)=>{const m=this.clienteStatus(e?.id),o=this.clienteStatus(r?.id),n=d[m]||99,l=d[o]||99;if(n!==l)return n-l;const c=String(e?.nombre||"").toLowerCase(),_=String(r?.nombre||"").toLowerCase();return c.localeCompare(_,"es")})},detalleTipoLabel(){return this.detalleTipo==="RES"?"Res":this.detalleTipo==="CERDO"?"Cerdo":this.detalleTipo==="POLLO"?"Pollo":"Normal"}},mounted(){this.initMap(),this.cargarClientes(),this.cargarProductos()},beforeUnmount(){this.isAlive=!1;try{this.map&&(this.map.off(),this.map.remove())}catch{}this.map=null,this.markersLayer=null,this.meMarker=null},methods:{markerColor(d){const e=this.normalizeStatus(d);return e==="REALIZAR_PEDIDO"?"#16a34a":e==="RETORNAR"?"#f4b400":e==="NO_PEDIDO"?"#e53935":e==="GENERAR_RUTA"?"#7e22ce":"#1e88e5"},statusColor(d){const e=this.normalizeStatus(d);return e==="RETORNAR"?"warning":e==="NO_PEDIDO"?"negative":e==="REALIZAR_PEDIDO"?"positive":e==="GENERAR_RUTA"?"purple":"primary"},normalizeStatus(d){return String(d||"ACTIVO").trim().toUpperCase()},normalizeTipoProducto(d){const e=String(d||"NORMAL").trim().toUpperCase();return e==="RES"||e==="CERDO"||e==="POLLO"?e:"NORMAL"},detalleDefaultsByTipo(d){return d==="RES"?{precio_res:"",res_trozado:"",res_entero:"",res_pierna:"",res_brazo:"",observacion:""}:d==="CERDO"?{cerdo_precio_total:"",cerdo_entero:"",cerdo_desmembrado:"",cerdo_corte:"",cerdo_kilo:"",observacion:""}:d==="POLLO"?{pollo_cja_b5:"",pollo_uni_b5:"",pollo_cja_b6:"",pollo_uni_b6:"",pollo_cja_104:"",pollo_uni_104:"",pollo_cja_105:"",pollo_uni_105:"",pollo_cja_106:"",pollo_uni_106:"",pollo_cja_107:"",pollo_uni_107:"",pollo_cja_108:"",pollo_uni_108:"",pollo_cja_109:"",pollo_uni_109:"",pollo_rango_unidades:"",pollo_ala:"",pollo_ala_unidad:"KG",pollo_cadera:"",pollo_cadera_unidad:"KG",pollo_pecho:"",pollo_pecho_unidad:"KG",pollo_pi_mu:"",pollo_pi_mu_unidad:"KG",pollo_filete:"",pollo_filete_unidad:"KG",pollo_cuello:"",pollo_cuello_unidad:"KG",pollo_hueso:"",pollo_hueso_unidad:"KG",pollo_menudencia:"",pollo_menudencia_unidad:"KG",pollo_bs:"",pollo_bs2:"",observacion:""}:{observacion:""}},openDetalleDialog(d,e){this.detalleEditIndex=e,this.detalleTipo=this.normalizeTipoProducto(d?.tipo);const r=this.detalleDefaultsByTipo(this.detalleTipo);this.detalleEdit={...r,...d?.detalle_extra||{}},this.dialogDetalle=!0},saveDetalleDialog(){if(this.detalleEditIndex<0||!this.pedidoItems[this.detalleEditIndex])return;const d=this.pedidoItems[this.detalleEditIndex];d.detalle_extra={...this.detalleEdit},d.observacion=this.detalleEdit.observacion||d.observacion||"",this.dialogDetalle=!1,this.detalleEditIndex=-1,this.detalleEdit={}},rowClassByCliente(d){const e=this.clienteStatus(d?.id);return e==="RETORNAR"?"cliente-retornar":e==="NO_PEDIDO"?"cliente-no-pedido":e==="REALIZAR_PEDIDO"?"cliente-pedido":""},clienteStatus(d){return d?this.normalizeStatus(this.visitasByCliente[d]?.tipo_visita||"ACTIVO"):"ACTIVO"},mapReady(){return!!(this.map&&this.map._loaded&&this.map.getPane&&this.map.getPane("mapPane"))},initMap(){if(!this.$refs.mapRef||!this.isAlive)return;this.map=f.map(this.$refs.mapRef,{center:te,zoom:13});const d=f.tileLayer("https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}",{maxZoom:21,attribution:"Map data © Google"}),e=f.tileLayer("https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{maxZoom:21,attribution:"Map data © Google"}),r=f.tileLayer("https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",{maxZoom:21,attribution:"Map data © Google"}),m=f.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"});d.addTo(this.map),f.control.layers({"Google Calle":d,"Google Satelite":e,"Google Hibrido":r,OpenStreetMap:m}).addTo(this.map),this.markersLayer=f.layerGroup().addTo(this.map)},async cargarClientes(){this.loading=!0;try{const d=await this.$axios.get("clientes",{params:{search:this.search,per_page:500,solo_mios:1,solo_dia:this.showAllDays?0:1,dia:this.dayCode}});if(!this.isAlive)return;this.clientes=d.data?.data||[],await this.cargarVisitas(),this.renderMarkers()}catch(d){this.$alert.error(d.response?.data?.message||"No se pudo cargar clientes de visitas")}finally{this.isAlive&&(this.loading=!1)}},renderMarkers(){if(!this.mapReady()||!this.markersLayer)return;this.markersLayer.clearLayers();const d=[];if(this.clientes.forEach(e=>{if(!Number.isFinite(Number(e.latitud))||!Number.isFinite(Number(e.longitud)))return;const r=Number(e.latitud),m=Number(e.longitud),o=e.codcli||e.id,n=this.clienteStatus(e.id),l=this.markerColor(n),c=f.circleMarker([r,m],{radius:9,fillColor:l,color:"#fff",weight:3,fillOpacity:.95}).addTo(this.markersLayer);c.bindTooltip(String(o),{permanent:!0,direction:"top",className:"cliente-id-tooltip"}),c.on("click",()=>this.openAcciones(e)),d.push([r,m])}),d.length>0&&this.mapReady())try{this.map.fitBounds(d,{padding:[35,35],maxZoom:16})}catch{}},setDayFilter(d){this.showAllDays=d,this.cargarClientes()},async cargarVisitas(){try{const d=await this.$axios.get("visitas",{params:{solo_mios:1,all_days:0,latest_per_cliente:1,fecha:new Date().toISOString().slice(0,10)}}),e=Array.isArray(d.data)?d.data:d.data?.data||[],r={};e.forEach(m=>{m?.cliente_id&&(r[m.cliente_id]=m)}),this.visitasByCliente=r}catch{this.visitasByCliente={}}},locateMe(){if(this.mapReady()){if(!navigator.geolocation){this.$alert.error("Geolocalizacion no disponible");return}navigator.geolocation.getCurrentPosition(d=>{if(!this.mapReady())return;const e=Number(d.coords.latitude.toFixed(7)),r=Number(d.coords.longitude.toFixed(7));this.meMarker&&this.map.removeLayer(this.meMarker),this.meMarker=f.circleMarker([e,r],{radius:10,fillColor:"#ff1744",color:"#fff",weight:3,fillOpacity:.95}).addTo(this.map),this.meMarker.bindPopup("Aqui estoy yo").openPopup();try{this.map.flyTo([e,r],16)}catch{}},()=>this.$alert.error("No se pudo obtener tu ubicacion"))}},openAcciones(d){this.selectedCliente=d,this.loadingAccion="",this.dialogAcciones=!0},async accionSeleccionada(d){if(this.selectedCliente){if(d==="REALIZAR_PEDIDO"){this.dialogAcciones=!1,this.loadingPedido=!1,this.pedidoItems=[],this.facturadoPedido=!1,this.fechaPedido=new Date().toISOString().slice(0,10),this.horaPedido=null,this.dialogPedido=!0;return}d==="GENERAR_RUTA"&&this.generarRuta(),this.guardarAccion(d)}},async guardarAccion(d){if(this.selectedCliente){this.loadingAccion=d,this.loading=!0;try{await this.$axios.post("pedidos",{tipo_pedido:d,cliente_id:this.selectedCliente.id,comentario_visita:this.comentario||"",observaciones:this.comentario||"",productos:[]}),this.$alert.success("Accion registrada"),this.dialogAcciones=!1,this.comentario="",await this.cargarVisitas(),this.renderMarkers()}catch(e){this.$alert.error(e.response?.data?.message||"No se pudo registrar la accion")}finally{this.loadingAccion="",this.loading=!1}}},generarRuta(){if(!this.selectedCliente)return;const d=Number(this.selectedCliente.latitud),e=Number(this.selectedCliente.longitud);if(!Number.isFinite(d)||!Number.isFinite(e)){this.$alert.error("El cliente no tiene coordenadas");return}window.open(`https://www.google.com/maps/dir/?api=1&destination=${d},${e}`,"_blank")},mapStockOption(d){return{id:d.id,label:`${d.codigo||d.id}-${d.nombre} ${Number(d.precio1||0).toFixed(2)}Bs ${Number(d.stock||0).toFixed(2)}U`,nombre:d.nombre,codigo:d.codigo,imagen:d.imagen||"uploads/default.png",precio:Number(d.precio1||0),stock:Number(d.stock||0),tipo:this.normalizeTipoProducto(d.tipo)}},productImageUrl(d){const e=d||"uploads/default.png";return`${this.$url}../${e}`},async cargarProductos(){try{const[d,e]=await Promise.all([this.$axios.get("productosStock",{params:{per_page:500}}),this.$axios.get("productosAll")]),r=d.data?.data||[],o=(Array.isArray(e.data)?e.data:[]).filter(c=>de.includes(String(c?.tipo||"").toUpperCase())),n=new Map;[...r,...o].forEach(c=>{c?.id&&n.set(c.id,c)});const l={POLLO:1,RES:2,CERDO:3};this.productosSource=Array.from(n.values()).sort((c,_)=>{const Q=String(c?.tipo||"").toUpperCase(),B=String(_?.tipo||"").toUpperCase(),I=l[Q]||99,N=l[B]||99;return I!==N?I-N:String(c?.nombre||"").localeCompare(String(_?.nombre||""),"es")}),this.productos=this.productosSource.map(this.mapStockOption)}catch{this.productos=[],this.productosSource=[]}},filtrarProductos(d,e){e(()=>{const r=(d||"").toLowerCase();if(!r){this.productos=this.productosSource.map(this.mapStockOption);return}this.productos=this.productosSource.filter(m=>`${m.nombre||""} ${m.codigo||""}`.toLowerCase().includes(r)).map(this.mapStockOption)})},agregarProducto(){if(!this.productoSeleccionado)return;const d=this.productos.find(r=>r.id===this.productoSeleccionado);if(!d)return;const e=this.pedidoItems.find(r=>r.producto_id===d.id);e?e.cantidad+=1:this.pedidoItems.push({producto_id:d.id,codigo:d.codigo,nombre:d.nombre,imagen:d.imagen||"uploads/default.png",cantidad:1,precio:Number(d.precio||0),observacion:"",tipo:this.normalizeTipoProducto(d.tipo),detalle_extra:this.detalleDefaultsByTipo(this.normalizeTipoProducto(d.tipo))}),this.productoSeleccionado=null},async guardarPedido(){if(!this.selectedCliente)return;if(this.pedidoItems.length===0){this.$alert.error("Debe agregar al menos un producto");return}const d=this.pedidoItems.map(e=>({producto_id:e.producto_id,cantidad:Number(e.cantidad||0),precio:Number(e.precio||0),observacion:e.observacion||"",detalle_extra:e.detalle_extra||null})).filter(e=>e.cantidad>0&&e.precio>=0);if(d.length===0){this.$alert.error("Revise cantidades y precios");return}this.loadingPedido=!0,this.loading=!0;try{await this.$axios.post("pedidos",{tipo_pedido:"REALIZAR_PEDIDO",tipo_pago:this.tipoPago,facturado:this.facturadoPedido,fecha:this.fechaPedido,hora:this.horaPedido,cliente_id:this.selectedCliente.id,comentario_visita:this.comentario||"",observaciones:this.comentario||"",productos:d}),this.$alert.success("Pedido registrado"),this.dialogPedido=!1,this.comentario="",this.pedidoItems=[],await this.cargarVisitas(),this.renderMarkers()}catch(e){this.$alert.error(e.response?.data?.message||"No se pudo registrar pedido")}finally{this.loadingPedido=!1,this.loading=!1}}}},ae={ref:"mapRef",class:"visitas-map"},ne={class:"map-toolbar-left"},re={class:"map-toolbar-right"},ue={class:"col-12 col-md-4"},ce={class:"col-12 col-md-auto"},me={class:"col-12 col-md-auto"},pe=["onClick"],_e={class:"text-h6"},be={class:"row q-col-gutter-sm"},ge={class:"col-12 col-md-6"},he={class:"q-mt-sm"},fe={class:"col-12 col-md-6"},Ve={class:"col-12 col-md-6"},ve={class:"col-12 col-md-6"},Ee={class:"col-12 col-md-6"},Ce={class:"col-12 col-md-6"},ye={class:"text-h6"},Ue={class:"row q-col-gutter-sm"},Pe={class:"col-12 col-md-4"},Re={class:"col-12 col-md-2"},Ae={class:"col-12 col-md-3"},De={class:"col-12 col-md-3"},Oe={class:"col-12 col-md-12"},Se={class:"col-12 col-md-10"},ke={class:"row items-center no-wrap q-gutter-xs"},we={class:"ellipsis"},xe={class:"col-12 col-md-2"},Ie=["onUpdate:modelValue","onInput"],Ne=["onUpdate:modelValue","onInput"],Te={class:"row items-center no-wrap q-gutter-sm"},Le={key:0},ze={class:"text-h6 q-mt-sm"},je={class:"text-h6"},Me={key:0,class:"row q-col-gutter-sm"},Qe={class:"col-12"},Be={key:1,class:"row q-col-gutter-sm"},Ge={class:"col-12 col-md-4"},qe={class:"col-12 col-md-4"},Fe={class:"col-12 col-md-4"},Ze={class:"col-12 col-md-6"},Ke={class:"col-12 col-md-6"},He={class:"col-12"},Je={key:2,class:"row q-col-gutter-sm"},Ye={class:"col-12 col-md-4"},We={class:"col-12 col-md-4"},Xe={class:"col-12 col-md-4"},$e={class:"col-12 col-md-6"},el={class:"col-12 col-md-6"},ll={class:"col-12"},ol={key:3,class:"row q-col-gutter-sm"},tl={class:"col-12 col-md-6"},il={class:"col-12 col-md-6"},dl={class:"col-12 col-md-6"},sl={class:"col-12 col-md-6"},al={class:"col-12 col-md-6"},nl={class:"col-12 col-md-6"},rl={class:"col-12 col-md-6"},ul={class:"col-12 col-md-6"},cl={class:"col-12 col-md-6"},ml={class:"col-12 col-md-6"},pl={class:"col-12 col-md-6"},_l={class:"col-12 col-md-6"},bl={class:"col-12 col-md-6"},gl={class:"col-12 col-md-6"},hl={class:"col-12 col-md-6"},fl={class:"col-12 col-md-6"},Vl={class:"col-12"},vl={class:"col-12 col-md-6"},El={class:"col-12 col-md-6"},Cl={class:"col-12 col-md-6"},yl={class:"col-12 col-md-6"},Ul={class:"col-12 col-md-6"},Pl={class:"col-12 col-md-6"},Rl={class:"col-12 col-md-6"},Al={class:"col-12 col-md-6"},Dl={class:"col-12 col-md-6"},Ol={class:"col-12 col-md-6"},Sl={class:"col-12 col-md-6"},kl={class:"col-12 col-md-6"},wl={class:"col-12 col-md-6"},xl={class:"col-12 col-md-6"},Il={class:"col-12 col-md-6"},Nl={class:"col-12 col-md-6"},Tl={class:"col-12 col-md-6"},Ll={class:"col-12 col-md-6"},zl={class:"col-12"};function jl(d,e,r,m,o,n){return b(),R($,{class:"q-pa-xs"},{default:a(()=>[t(y,{flat:"",bordered:""},{default:a(()=>[i("div",ae,null,512),i("div",ne,[t(p,{color:"orange",icon:"format_list_bulleted",outline:!o.showAllDays,onClick:e[0]||(e[0]=l=>n.setDayFilter(!1)),"no-caps":"",label:"Del dia"},null,8,["outline"]),t(p,{color:"primary",icon:"calendar_month",outline:o.showAllDays,onClick:e[1]||(e[1]=l=>n.setDayFilter(!0)),"no-caps":"",label:"Todos",class:"q-ml-xs"},null,8,["outline"])]),i("div",re,[t(p,{color:"negative",icon:"my_location",onClick:n.locateMe,round:"",dense:""},null,8,["onClick"])])]),_:1}),t(y,{flat:"",bordered:"",class:"q-mt-xs"},{default:a(()=>[t(v,{class:"row items-center q-col-gutter-sm q-py-sm"},{default:a(()=>[i("div",ue,[t(s,{modelValue:o.search,"onUpdate:modelValue":[e[2]||(e[2]=l=>o.search=l),n.cargarClientes],dense:"",outlined:"",label:"Buscar cliente",debounce:"350"},{append:a(()=>[t(A,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),i("div",ce,[t(P,{color:"teal","text-color":"white"},{default:a(()=>[g("Clientes: "+u(o.clientes.length),1)]),_:1})]),i("div",me,[t(P,{color:"primary","text-color":"white"},{default:a(()=>[g("Dia: "+u(n.dayLabel),1)]),_:1})])]),_:1}),t(M,{dense:"",flat:"","wrap-cells":""},{default:a(()=>[e[68]||(e[68]=i("thead",null,[i("tr",null,[i("th",null,"Accion"),i("th",null,"Cliente"),i("th",null,"Direccion"),i("th",null,"Telefono"),i("th",null,"Estado")])],-1)),i("tbody",null,[(b(!0),V(T,null,L(n.clientesOrdenados,l=>(b(),V("tr",{key:l.id,class:q([o.selectedCliente?.id===l.id?"row-selected":"",n.rowClassByCliente(l)]),onClick:c=>n.openAcciones(l)},[i("td",null,[t(p,{color:"purple",icon:"visibility",dense:"",round:"",onClick:c=>n.openAcciones(l)},null,8,["onClick"])]),i("td",null,u(l.codcli)+" -"+u(l.nombre),1),i("td",null,u(l.direccion||"-"),1),i("td",null,u(l.telefono||"-"),1),i("td",null,[t(P,{dense:"",color:n.statusColor(n.clienteStatus(l.id)),"text-color":"white"},{default:a(()=>[g(u(n.clienteStatus(l.id)),1)]),_:2},1032,["color"])])],10,pe))),128))])]),_:1})]),_:1}),t(D,{modelValue:o.dialogAcciones,"onUpdate:modelValue":e[8]||(e[8]=l=>o.dialogAcciones=l)},{default:a(()=>[t(y,{style:{"min-width":"900px","max-width":"95vw"}},{default:a(()=>[t(v,{class:"row items-center q-pb-none"},{default:a(()=>[i("div",_e,u(o.selectedCliente?.codcli||o.selectedCliente?.id)+" "+u(o.selectedCliente?.nombre),1),t(k),E(t(p,{flat:"",round:"",dense:"",icon:"close"},null,512),[[U]])]),_:1}),t(v,null,{default:a(()=>[i("div",be,[i("div",ge,[i("div",null,[e[69]||(e[69]=i("b",null,"Cel:",-1)),g(" "+u(o.selectedCliente?.telefono||"-"),1)]),i("div",null,[e[70]||(e[70]=i("b",null,"Direccion:",-1)),g(" "+u(o.selectedCliente?.direccion||"-"),1)]),i("div",he,[e[71]||(e[71]=g(" Estado para pedidos: ")),t(P,{dense:"",color:n.statusColor(n.clienteStatus(o.selectedCliente?.id)),"text-color":"white"},{default:a(()=>[g(u(n.clienteStatus(o.selectedCliente?.id)),1)]),_:1},8,["color"])])]),i("div",fe,[t(s,{modelValue:o.comentario,"onUpdate:modelValue":e[3]||(e[3]=l=>o.comentario=l),label:"Comentario",outlined:"",dense:"",type:"textarea",autogrow:""},null,8,["modelValue"])])])]),_:1}),t(O,{align:"stretch",class:"row q-col-gutter-sm q-px-md q-pb-md"},{default:a(()=>[i("div",Ve,[t(p,{color:"green",icon:"shopping_cart","no-caps":"",class:"full-width",label:"Realizar pedido",onClick:e[4]||(e[4]=l=>n.accionSeleccionada("REALIZAR_PEDIDO")),loading:o.loadingAccion==="REALIZAR_PEDIDO",disable:!!o.loadingAccion},null,8,["loading","disable"])]),i("div",ve,[t(p,{color:"warning",icon:"history","no-caps":"",class:"full-width",label:"Retornar",onClick:e[5]||(e[5]=l=>n.accionSeleccionada("RETORNAR")),loading:o.loadingAccion==="RETORNAR",disable:!!o.loadingAccion},null,8,["loading","disable"])]),i("div",Ee,[t(p,{color:"negative",icon:"close","no-caps":"",class:"full-width",label:"No pedido",onClick:e[6]||(e[6]=l=>n.accionSeleccionada("NO_PEDIDO")),loading:o.loadingAccion==="NO_PEDIDO",disable:!!o.loadingAccion},null,8,["loading","disable"])]),i("div",Ce,[t(p,{color:"purple",icon:"map","no-caps":"",class:"full-width",label:"Generar ruta",onClick:e[7]||(e[7]=l=>n.accionSeleccionada("GENERAR_RUTA")),loading:o.loadingAccion==="GENERAR_RUTA",disable:!!o.loadingAccion},null,8,["loading","disable"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(D,{modelValue:o.dialogPedido,"onUpdate:modelValue":e[17]||(e[17]=l=>o.dialogPedido=l),maximized:""},{default:a(()=>[t(y,null,{default:a(()=>[t(v,{class:"row items-center q-pb-none"},{default:a(()=>[i("div",ye,u(o.selectedCliente?.codcli||o.selectedCliente?.id)+" "+u(o.selectedCliente?.nombre),1),t(k),t(p,{flat:"",round:"",dense:"",icon:"close",onClick:e[9]||(e[9]=l=>o.dialogPedido=!1)})]),_:1}),t(v,{class:"q-pt-sm"},{default:a(()=>[i("div",Ue,[i("div",Pe,[t(F,{modelValue:o.tipoPago,"onUpdate:modelValue":e[10]||(e[10]=l=>o.tipoPago=l),options:o.tiposPago,type:"radio",color:"primary",inline:""},null,8,["modelValue","options"])]),i("div",Re,[t(Z,{modelValue:o.facturadoPedido,"onUpdate:modelValue":e[11]||(e[11]=l=>o.facturadoPedido=l),label:"Facturado"},null,8,["modelValue"])]),i("div",Ae,[t(s,{modelValue:o.fechaPedido,"onUpdate:modelValue":e[12]||(e[12]=l=>o.fechaPedido=l),type:"date",label:"Fecha",dense:"",outlined:""},null,8,["modelValue"])]),i("div",De,[t(h,{modelValue:o.horaPedido,"onUpdate:modelValue":e[13]||(e[13]=l=>o.horaPedido=l),options:o.horariosPedido,label:"Horario",dense:"",outlined:"","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"])]),i("div",Oe,[t(s,{modelValue:o.comentario,"onUpdate:modelValue":e[14]||(e[14]=l=>o.comentario=l),label:"Comentario",dense:"",outlined:""},null,8,["modelValue"])]),i("div",Se,[t(h,{modelValue:o.productoSeleccionado,"onUpdate:modelValue":e[15]||(e[15]=l=>o.productoSeleccionado=l),options:o.productos,"option-label":"label","option-value":"id","emit-value":"","map-options":"",dense:"",outlined:"",label:"Productos (solo stock de compras)","use-input":"","input-debounce":"350",onFilter:n.filtrarProductos},{"selected-item":a(l=>[i("div",ke,[t(S,{rounded:"",size:"24px"},{default:a(()=>[t(w,{src:n.productImageUrl(l?.opt?.imagen)},null,8,["src"])]),_:2},1024),i("span",we,u(l?.opt?.label||""),1)])]),option:a(l=>[t(x,K(H(l.itemProps)),{default:a(()=>[t(C,{avatar:""},{default:a(()=>[t(S,{rounded:"",size:"28px"},{default:a(()=>[t(w,{src:n.productImageUrl(l.opt.imagen)},null,8,["src"])]),_:2},1024)]),_:2},1024),t(C,null,{default:a(()=>[t(Y,null,{default:a(()=>[g(u(l.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","onFilter"])]),i("div",xe,[t(p,{color:"negative",icon:"add",class:"full-width",onClick:n.agregarProducto},null,8,["onClick"])])]),t(M,{dense:"",flat:"",bordered:"",class:"q-mt-sm"},{default:a(()=>[e[75]||(e[75]=i("thead",null,[i("tr",null,[i("th",null,"Detalle"),i("th",null,"Subtotal"),i("th",null,"Cantidad"),i("th",null,"Precio"),i("th",null,"Cod"),i("th",null,"Nombre"),i("th",null,"Obs")])],-1)),i("tbody",null,[(b(!0),V(T,null,L(o.pedidoItems,(l,c)=>(b(),V("tr",{key:`${l.producto_id}-${c}`},[i("td",null,[t(X,{dense:"",label:"Op("+l.tipo+")",color:n.normalizeTipoProducto(l.tipo)==="RES"?"red":n.normalizeTipoProducto(l.tipo)==="CERDO"?"brown":n.normalizeTipoProducto(l.tipo)==="POLLO"?"orange":"primary","no-caps":"",size:"10px"},{default:a(()=>[t(W,null,{default:a(()=>[E((b(),R(x,{clickable:"",onClick:_=>n.openDetalleDialog(l,c)},{default:a(()=>[t(C,{avatar:""},{default:a(()=>[t(A,{name:"tune",color:"purple"})]),_:1}),t(C,null,{default:a(()=>e[72]||(e[72]=[g("Editar detalle")])),_:1})]),_:2},1032,["onClick"])),[[z],[U]]),E((b(),R(x,{clickable:"",onClick:_=>o.pedidoItems.splice(c,1)},{default:a(()=>[t(C,{avatar:""},{default:a(()=>[t(A,{name:"delete",color:"negative"})]),_:1}),t(C,null,{default:a(()=>e[73]||(e[73]=[g("Eliminar producto")])),_:1})]),_:2},1032,["onClick"])),[[z],[U]])]),_:2},1024)]),_:2},1032,["label","color"])]),i("td",null,u((Number(l.cantidad)*Number(l.precio)).toFixed(2)),1),i("td",null,[E(i("input",{type:"text","onUpdate:modelValue":_=>l.cantidad=_,style:{width:"40px"},onInput:_=>l.cantidad=l.cantidad<1?1:l.cantidad},null,40,Ie),[[j,l.cantidad,void 0,{number:!0}]])]),i("td",null,[E(i("input",{type:"text","onUpdate:modelValue":_=>l.precio=_,style:{width:"50px"},onInput:_=>l.precio=l.precio<0?0:l.precio},null,40,Ne),[[j,l.precio,void 0,{number:!0}]])]),i("td",null,u(l.codigo||l.producto_id),1),i("td",null,[i("div",Te,[t(S,{rounded:"",size:"30px"},{default:a(()=>[t(w,{src:n.productImageUrl(l.imagen)},null,8,["src"])]),_:2},1024),i("div",null,u(l.nombre),1)])]),i("td",null,u(l.observacion||"-"),1)]))),128)),o.pedidoItems.length===0?(b(),V("tr",Le,e[74]||(e[74]=[i("td",{colspan:"8",class:"text-grey-7"},"Sin datos disponibles",-1)]))):J("",!0)])]),_:1}),i("div",ze,"Total: "+u(n.totalPedido.toFixed(2))+" Bs.",1)]),_:1}),t(O,{align:"between",class:"q-pa-md"},{default:a(()=>[t(p,{flat:"",color:"negative",label:"Cerrar",onClick:e[16]||(e[16]=l=>o.dialogPedido=!1)}),t(p,{color:"green","no-caps":"",icon:"send",label:"Realizar pedido",loading:o.loadingPedido,disable:o.loadingPedido||!!o.loadingAccion,onClick:n.guardarPedido},null,8,["loading","disable","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(D,{modelValue:o.dialogDetalle,"onUpdate:modelValue":e[67]||(e[67]=l=>o.dialogDetalle=l)},{default:a(()=>[t(y,{style:{width:"450px","max-width":"96vw"}},{default:a(()=>[t(v,{class:"row items-center q-pb-none"},{default:a(()=>[i("div",je,"Pedido "+u(n.detalleTipoLabel),1),t(k),E(t(p,{flat:"",round:"",dense:"",icon:"close"},null,512),[[U]])]),_:1}),t(v,null,{default:a(()=>[o.detalleTipo==="NORMAL"?(b(),V("div",Me,[i("div",Qe,[t(s,{modelValue:o.detalleEdit.observacion,"onUpdate:modelValue":e[18]||(e[18]=l=>o.detalleEdit.observacion=l),dense:"",outlined:"",label:"Observacion detalle"},null,8,["modelValue"])])])):o.detalleTipo==="RES"?(b(),V("div",Be,[i("div",Ge,[t(s,{modelValue:o.detalleEdit.precio_res,"onUpdate:modelValue":e[19]||(e[19]=l=>o.detalleEdit.precio_res=l),dense:"",outlined:"",label:"Precio RES"},null,8,["modelValue"])]),i("div",qe,[t(s,{modelValue:o.detalleEdit.res_trozado,"onUpdate:modelValue":e[20]||(e[20]=l=>o.detalleEdit.res_trozado=l),dense:"",outlined:"",label:"Res trozado"},null,8,["modelValue"])]),i("div",Fe,[t(s,{modelValue:o.detalleEdit.res_entero,"onUpdate:modelValue":e[21]||(e[21]=l=>o.detalleEdit.res_entero=l),dense:"",outlined:"",label:"Res entero"},null,8,["modelValue"])]),i("div",Ze,[t(s,{modelValue:o.detalleEdit.res_pierna,"onUpdate:modelValue":e[22]||(e[22]=l=>o.detalleEdit.res_pierna=l),dense:"",outlined:"",label:"Res pierna"},null,8,["modelValue"])]),i("div",Ke,[t(s,{modelValue:o.detalleEdit.res_brazo,"onUpdate:modelValue":e[23]||(e[23]=l=>o.detalleEdit.res_brazo=l),dense:"",outlined:"",label:"Res brazo"},null,8,["modelValue"])]),i("div",He,[t(s,{modelValue:o.detalleEdit.observacion,"onUpdate:modelValue":e[24]||(e[24]=l=>o.detalleEdit.observacion=l),dense:"",outlined:"",label:"Observacion detalle"},null,8,["modelValue"])])])):o.detalleTipo==="CERDO"?(b(),V("div",Je,[i("div",Ye,[t(s,{modelValue:o.detalleEdit.cerdo_precio_total,"onUpdate:modelValue":e[25]||(e[25]=l=>o.detalleEdit.cerdo_precio_total=l),dense:"",outlined:"",label:"Precio total"},null,8,["modelValue"])]),i("div",We,[t(s,{modelValue:o.detalleEdit.cerdo_entero,"onUpdate:modelValue":e[26]||(e[26]=l=>o.detalleEdit.cerdo_entero=l),dense:"",outlined:"",label:"Cerdo entero"},null,8,["modelValue"])]),i("div",Xe,[t(s,{modelValue:o.detalleEdit.cerdo_kilo,"onUpdate:modelValue":e[27]||(e[27]=l=>o.detalleEdit.cerdo_kilo=l),dense:"",outlined:"",label:"Cerdo kilo"},null,8,["modelValue"])]),i("div",$e,[t(s,{modelValue:o.detalleEdit.cerdo_desmembrado,"onUpdate:modelValue":e[28]||(e[28]=l=>o.detalleEdit.cerdo_desmembrado=l),dense:"",outlined:"",label:"Cerdo desmembrado"},null,8,["modelValue"])]),i("div",el,[t(s,{modelValue:o.detalleEdit.cerdo_corte,"onUpdate:modelValue":e[29]||(e[29]=l=>o.detalleEdit.cerdo_corte=l),dense:"",outlined:"",label:"Cerdo corte"},null,8,["modelValue"])]),i("div",ll,[t(s,{modelValue:o.detalleEdit.observacion,"onUpdate:modelValue":e[30]||(e[30]=l=>o.detalleEdit.observacion=l),dense:"",outlined:"",label:"Observacion detalle"},null,8,["modelValue"])])])):(b(),V("div",ol,[i("div",tl,[t(s,{modelValue:o.detalleEdit.pollo_cja_b5,"onUpdate:modelValue":e[31]||(e[31]=l=>o.detalleEdit.pollo_cja_b5=l),dense:"",outlined:"",label:"Cja b5"},null,8,["modelValue"])]),i("div",il,[t(s,{modelValue:o.detalleEdit.pollo_uni_b5,"onUpdate:modelValue":e[32]||(e[32]=l=>o.detalleEdit.pollo_uni_b5=l),dense:"",outlined:"",label:"Uni b5"},null,8,["modelValue"])]),i("div",dl,[t(s,{modelValue:o.detalleEdit.pollo_cja_b6,"onUpdate:modelValue":e[33]||(e[33]=l=>o.detalleEdit.pollo_cja_b6=l),dense:"",outlined:"",label:"Cja b6"},null,8,["modelValue"])]),i("div",sl,[t(s,{modelValue:o.detalleEdit.pollo_uni_b6,"onUpdate:modelValue":e[34]||(e[34]=l=>o.detalleEdit.pollo_uni_b6=l),dense:"",outlined:"",label:"Uni b6"},null,8,["modelValue"])]),i("div",al,[t(s,{modelValue:o.detalleEdit.pollo_cja_104,"onUpdate:modelValue":e[35]||(e[35]=l=>o.detalleEdit.pollo_cja_104=l),dense:"",outlined:"",label:"Cja-104 (1.5-1.7)"},null,8,["modelValue"])]),i("div",nl,[t(s,{modelValue:o.detalleEdit.pollo_uni_104,"onUpdate:modelValue":e[36]||(e[36]=l=>o.detalleEdit.pollo_uni_104=l),dense:"",outlined:"",label:"Unid-104"},null,8,["modelValue"])]),i("div",rl,[t(s,{modelValue:o.detalleEdit.pollo_cja_105,"onUpdate:modelValue":e[37]||(e[37]=l=>o.detalleEdit.pollo_cja_105=l),dense:"",outlined:"",label:"Cja-105 (1.7-1.9)"},null,8,["modelValue"])]),i("div",ul,[t(s,{modelValue:o.detalleEdit.pollo_uni_105,"onUpdate:modelValue":e[38]||(e[38]=l=>o.detalleEdit.pollo_uni_105=l),dense:"",outlined:"",label:"Unid-105"},null,8,["modelValue"])]),i("div",cl,[t(s,{modelValue:o.detalleEdit.pollo_cja_106,"onUpdate:modelValue":e[39]||(e[39]=l=>o.detalleEdit.pollo_cja_106=l),dense:"",outlined:"",label:"Cja-106 (1.9-2.2)"},null,8,["modelValue"])]),i("div",ml,[t(s,{modelValue:o.detalleEdit.pollo_uni_106,"onUpdate:modelValue":e[40]||(e[40]=l=>o.detalleEdit.pollo_uni_106=l),dense:"",outlined:"",label:"Unid-106"},null,8,["modelValue"])]),i("div",pl,[t(s,{modelValue:o.detalleEdit.pollo_cja_107,"onUpdate:modelValue":e[41]||(e[41]=l=>o.detalleEdit.pollo_cja_107=l),dense:"",outlined:"",label:"Cja-107 (2.2-2.5)"},null,8,["modelValue"])]),i("div",_l,[t(s,{modelValue:o.detalleEdit.pollo_uni_107,"onUpdate:modelValue":e[42]||(e[42]=l=>o.detalleEdit.pollo_uni_107=l),dense:"",outlined:"",label:"Unid-107"},null,8,["modelValue"])]),i("div",bl,[t(s,{modelValue:o.detalleEdit.pollo_cja_108,"onUpdate:modelValue":e[43]||(e[43]=l=>o.detalleEdit.pollo_cja_108=l),dense:"",outlined:"",label:"Cja-108 (2.6-2.7)"},null,8,["modelValue"])]),i("div",gl,[t(s,{modelValue:o.detalleEdit.pollo_uni_108,"onUpdate:modelValue":e[44]||(e[44]=l=>o.detalleEdit.pollo_uni_108=l),dense:"",outlined:"",label:"Unid-108"},null,8,["modelValue"])]),i("div",hl,[t(s,{modelValue:o.detalleEdit.pollo_cja_109,"onUpdate:modelValue":e[45]||(e[45]=l=>o.detalleEdit.pollo_cja_109=l),dense:"",outlined:"",label:"Cja-109 (2.8-2.9)"},null,8,["modelValue"])]),i("div",fl,[t(s,{modelValue:o.detalleEdit.pollo_uni_109,"onUpdate:modelValue":e[46]||(e[46]=l=>o.detalleEdit.pollo_uni_109=l),dense:"",outlined:"",label:"Unid-109"},null,8,["modelValue"])]),i("div",Vl,[t(s,{modelValue:o.detalleEdit.pollo_rango_unidades,"onUpdate:modelValue":e[47]||(e[47]=l=>o.detalleEdit.pollo_rango_unidades=l),dense:"",outlined:"",label:"Rango pollo (unidades)"},null,8,["modelValue"])]),i("div",vl,[t(s,{modelValue:o.detalleEdit.pollo_ala,"onUpdate:modelValue":e[48]||(e[48]=l=>o.detalleEdit.pollo_ala=l),dense:"",outlined:"",label:"Ala"},null,8,["modelValue"])]),i("div",El,[t(h,{modelValue:o.detalleEdit.pollo_ala_unidad,"onUpdate:modelValue":e[49]||(e[49]=l=>o.detalleEdit.pollo_ala_unidad=l),options:o.unidadesPollo,dense:"",outlined:"",label:"Unidad ala"},null,8,["modelValue","options"])]),i("div",Cl,[t(s,{modelValue:o.detalleEdit.pollo_cadera,"onUpdate:modelValue":e[50]||(e[50]=l=>o.detalleEdit.pollo_cadera=l),dense:"",outlined:"",label:"Cadera"},null,8,["modelValue"])]),i("div",yl,[t(h,{modelValue:o.detalleEdit.pollo_cadera_unidad,"onUpdate:modelValue":e[51]||(e[51]=l=>o.detalleEdit.pollo_cadera_unidad=l),options:o.unidadesPollo,dense:"",outlined:"",label:"Unidad cadera"},null,8,["modelValue","options"])]),i("div",Ul,[t(s,{modelValue:o.detalleEdit.pollo_pecho,"onUpdate:modelValue":e[52]||(e[52]=l=>o.detalleEdit.pollo_pecho=l),dense:"",outlined:"",label:"Pecho"},null,8,["modelValue"])]),i("div",Pl,[t(h,{modelValue:o.detalleEdit.pollo_pecho_unidad,"onUpdate:modelValue":e[53]||(e[53]=l=>o.detalleEdit.pollo_pecho_unidad=l),options:o.unidadesPollo,dense:"",outlined:"",label:"Unidad pecho"},null,8,["modelValue","options"])]),i("div",Rl,[t(s,{modelValue:o.detalleEdit.pollo_pi_mu,"onUpdate:modelValue":e[54]||(e[54]=l=>o.detalleEdit.pollo_pi_mu=l),dense:"",outlined:"",label:"Pi/Mu"},null,8,["modelValue"])]),i("div",Al,[t(h,{modelValue:o.detalleEdit.pollo_pi_mu_unidad,"onUpdate:modelValue":e[55]||(e[55]=l=>o.detalleEdit.pollo_pi_mu_unidad=l),options:o.unidadesPollo,dense:"",outlined:"",label:"Unidad pi/mu"},null,8,["modelValue","options"])]),i("div",Dl,[t(s,{modelValue:o.detalleEdit.pollo_filete,"onUpdate:modelValue":e[56]||(e[56]=l=>o.detalleEdit.pollo_filete=l),dense:"",outlined:"",label:"Filete"},null,8,["modelValue"])]),i("div",Ol,[t(h,{modelValue:o.detalleEdit.pollo_filete_unidad,"onUpdate:modelValue":e[57]||(e[57]=l=>o.detalleEdit.pollo_filete_unidad=l),options:o.unidadesPollo,dense:"",outlined:"",label:"Unidad filete"},null,8,["modelValue","options"])]),i("div",Sl,[t(s,{modelValue:o.detalleEdit.pollo_cuello,"onUpdate:modelValue":e[58]||(e[58]=l=>o.detalleEdit.pollo_cuello=l),dense:"",outlined:"",label:"Cuello"},null,8,["modelValue"])]),i("div",kl,[t(h,{modelValue:o.detalleEdit.pollo_cuello_unidad,"onUpdate:modelValue":e[59]||(e[59]=l=>o.detalleEdit.pollo_cuello_unidad=l),options:o.unidadesPollo,dense:"",outlined:"",label:"Unidad cuello"},null,8,["modelValue","options"])]),i("div",wl,[t(s,{modelValue:o.detalleEdit.pollo_hueso,"onUpdate:modelValue":e[60]||(e[60]=l=>o.detalleEdit.pollo_hueso=l),dense:"",outlined:"",label:"Hueso"},null,8,["modelValue"])]),i("div",xl,[t(h,{modelValue:o.detalleEdit.pollo_hueso_unidad,"onUpdate:modelValue":e[61]||(e[61]=l=>o.detalleEdit.pollo_hueso_unidad=l),options:o.unidadesPollo,dense:"",outlined:"",label:"Unidad hueso"},null,8,["modelValue","options"])]),i("div",Il,[t(s,{modelValue:o.detalleEdit.pollo_menudencia,"onUpdate:modelValue":e[62]||(e[62]=l=>o.detalleEdit.pollo_menudencia=l),dense:"",outlined:"",label:"Menudencia"},null,8,["modelValue"])]),i("div",Nl,[t(h,{modelValue:o.detalleEdit.pollo_menudencia_unidad,"onUpdate:modelValue":e[63]||(e[63]=l=>o.detalleEdit.pollo_menudencia_unidad=l),options:o.unidadesPollo,dense:"",outlined:"",label:"Unidad menudencia"},null,8,["modelValue","options"])]),i("div",Tl,[t(s,{modelValue:o.detalleEdit.pollo_bs,"onUpdate:modelValue":e[64]||(e[64]=l=>o.detalleEdit.pollo_bs=l),dense:"",outlined:"",label:"BS"},null,8,["modelValue"])]),i("div",Ll,[t(s,{modelValue:o.detalleEdit.pollo_bs2,"onUpdate:modelValue":e[65]||(e[65]=l=>o.detalleEdit.pollo_bs2=l),dense:"",outlined:"",label:"BS2"},null,8,["modelValue"])]),i("div",zl,[t(s,{modelValue:o.detalleEdit.observacion,"onUpdate:modelValue":e[66]||(e[66]=l=>o.detalleEdit.observacion=l),dense:"",outlined:"",label:"Observacion detalle"},null,8,["modelValue"])])]))]),_:1}),t(O,{align:"right"},{default:a(()=>[E(t(p,{flat:"",color:"negative",label:"Cerrar"},null,512),[[U]]),t(p,{color:"primary",label:"Guardar detalle",onClick:n.saveDetalleDialog},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const lo=G(se,[["render",jl],["__scopeId","data-v-66d3d77c"]]);export{lo as default};
