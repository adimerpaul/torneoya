import{_ as A,g as D,r as i,x as F,l as L,c as Q,o as u,w as n,a,Q as S,e as h,b as l,aa as b,d as k,f as v,a3 as $,a1 as T,a4 as P,a5 as j,t as d,aw as Z,a2 as p,Z as g,h as G,ar as H,ab as R}from"./index-CmoW1HI-.js";import{Q as N}from"./QChip-B_XB_8XG.js";import{a as z,b as y}from"./QMenu-j9-YnpjT.js";import{Q as X,C as _}from"./ClosePopup-veQafRnd.js";import{Q as J}from"./QMarkupTable-6CKuV8-r.js";import{Q as K}from"./QSpace-CghvMLQs.js";import{Q as W}from"./QForm-I0BS1mnk.js";import{Q as Y}from"./QPage-Dl-a7fNa.js";const ee={class:"col-12 col-md-4"},ae={class:"col-12 col-md-4 text-right"},le={key:0},oe={class:"text-h6"},te={class:"row q-col-gutter-sm"},se={class:"col-12"},ne={class:"col-12 col-md-6"},re={class:"col-12 col-md-6"},de={class:"col-12"},ie={class:"col-12"},ue={class:"text-right q-mt-md"},ce={__name:"ZonasMapa",setup(me){const{proxy:r}=D(),x=i([]),c=i(!1),C=i(!1),w=i(""),m=i(!1),s=i({id:null,nombre:"",color:"#607d8b",orden:0,activo:!0}),q=F(()=>{const t=w.value.trim().toLowerCase();return t?x.value.filter(e=>String(e.nombre||"").toLowerCase().includes(t)):x.value});function I(t){const e=String(t||"").replace("#","");if(e.length!==6)return"#ffffff";const o=parseInt(e.slice(0,2),16),V=parseInt(e.slice(2,4),16),U=parseInt(e.slice(4,6),16);return(o*299+V*587+U*114)/1e3>=140?"#1f2937":"#ffffff"}function B(){s.value={id:null,nombre:"",color:"#607d8b",orden:0,activo:!0},m.value=!0}function E(t){s.value={id:t.id,nombre:t.nombre,color:t.color||"#607d8b",orden:Number(t.orden||0),activo:!!t.activo},m.value=!0}async function M(){C.value=!0;try{const t={nombre:s.value.nombre,color:s.value.color||"#607d8b",orden:Number(s.value.orden||0),activo:!!s.value.activo};s.value.id?(await r.$axios.put(`/pedido-zonas/${s.value.id}`,t),r.$alert.success("Zona actualizada")):(await r.$axios.post("/pedido-zonas",t),r.$alert.success("Zona creada")),m.value=!1,await f()}catch(t){r.$alert.error(t?.response?.data?.message||"No se pudo guardar la zona")}finally{C.value=!1}}async function O(t){r.$alert.dialog(`Desea eliminar la zona ${t.nombre}?`).onOk(async()=>{c.value=!0;try{await r.$axios.delete(`/pedido-zonas/${t.id}`),r.$alert.success("Zona eliminada"),await f()}catch(e){r.$alert.error(e?.response?.data?.message||"No se pudo eliminar la zona")}finally{c.value=!1}})}async function f(){c.value=!0;try{const t=await r.$axios.get("/pedido-zonas");x.value=Array.isArray(t.data)?t.data:[]}catch(t){r.$alert.error(t?.response?.data?.message||"No se pudieron cargar zonas")}finally{c.value=!1}}return L(f),(t,e)=>(u(),Q(Y,{class:"q-pa-md zonas-page"},{default:n(()=>[a(S,{flat:"",bordered:""},{default:n(()=>[a(h,{class:"row items-center q-col-gutter-sm"},{default:n(()=>[e[6]||(e[6]=l("div",{class:"col-12 col-md-4"},[l("div",{class:"text-subtitle2 text-grey-7"},"Catalogo de zonas"),l("div",{class:"text-h6 text-weight-bold"},"Mapa cliente zonas")],-1)),l("div",ee,[a(b,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),dense:"",outlined:"",label:"Buscar zona"},{append:n(()=>[a(k,{name:"search"})]),_:1},8,["modelValue"])]),l("div",ae,[a(v,{color:"primary",icon:"add","no-caps":"",label:"Nueva zona",onClick:B,class:"q-mr-sm"}),a(v,{color:"grey-8",icon:"refresh","no-caps":"",label:"Actualizar",loading:c.value,onClick:f},null,8,["loading"])])]),_:1}),a(J,{flat:"",bordered:"",dense:"","wrap-cells":""},{default:n(()=>[e[10]||(e[10]=l("thead",null,[l("tr",{class:"bg-grey-2"},[l("th",null,"#"),l("th",null,"Nombre"),l("th",null,"Color"),l("th",null,"Orden"),l("th",null,"Activo"),l("th",null,"Opciones")])],-1)),l("tbody",null,[(u(!0),$(P,null,j(q.value,o=>(u(),$("tr",{key:o.id},[l("td",null,d(o.id),1),l("td",null,d(o.nombre),1),l("td",null,[a(N,{style:Z({backgroundColor:o.color,color:I(o.color)}),dense:""},{default:n(()=>[p(d(o.color),1)]),_:2},1032,["style"])]),l("td",null,d(o.orden),1),l("td",null,[a(N,{dense:"",color:o.activo?"green-7":"grey-6","text-color":"white"},{default:n(()=>[p(d(o.activo?"SI":"NO"),1)]),_:2},1032,["color"])]),l("td",null,[a(X,{dense:"",color:"primary",label:"Opciones","no-caps":"",size:"10px"},{default:n(()=>[g((u(),Q(z,{clickable:"",onClick:V=>E(o)},{default:n(()=>[a(y,{avatar:""},{default:n(()=>[a(k,{name:"edit"})]),_:1}),a(y,null,{default:n(()=>e[7]||(e[7]=[p("Editar")])),_:1})]),_:2},1032,["onClick"])),[[_]]),g((u(),Q(z,{clickable:"",onClick:V=>O(o)},{default:n(()=>[a(y,{avatar:""},{default:n(()=>[a(k,{name:"delete",color:"negative"})]),_:1}),a(y,null,{default:n(()=>e[8]||(e[8]=[p("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[_]])]),_:2},1024)])]))),128)),q.value.length===0?(u(),$("tr",le,e[9]||(e[9]=[l("td",{colspan:"6",class:"text-center text-grey-7"},"Sin registros",-1)]))):T("",!0)])]),_:1})]),_:1}),a(G,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=o=>m.value=o),persistent:""},{default:n(()=>[a(S,{style:{width:"520px","max-width":"96vw"}},{default:n(()=>[a(h,{class:"row items-center q-pb-none"},{default:n(()=>[l("div",oe,d(s.value.id?"Editar zona":"Nueva zona"),1),a(K),g(a(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[_]])]),_:1}),a(h,null,{default:n(()=>[a(W,{onSubmit:H(M,["prevent"])},{default:n(()=>[l("div",te,[l("div",se,[a(b,{modelValue:s.value.nombre,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.nombre=o),dense:"",outlined:"",label:"Nombre",rules:[o=>!!o||"Requerido"]},null,8,["modelValue","rules"])]),l("div",ne,[a(b,{modelValue:s.value.color,"onUpdate:modelValue":e[2]||(e[2]=o=>s.value.color=o),dense:"",outlined:"",label:"Color HEX",hint:"Ej: #2e7d32"},null,8,["modelValue"])]),l("div",re,[a(b,{modelValue:s.value.orden,"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.orden=o),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Orden"},null,8,["modelValue"])]),l("div",de,[a(R,{modelValue:s.value.activo,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.activo=o),label:"Activo",color:"primary"},null,8,["modelValue"])]),l("div",ie,[e[11]||(e[11]=l("div",{class:"text-caption text-grey-7 q-mb-xs"},"Vista previa",-1)),a(N,{style:Z({backgroundColor:s.value.color||"#607d8b",color:I(s.value.color||"#607d8b")}),dense:""},{default:n(()=>[p(d(s.value.nombre||"Nombre zona"),1)]),_:1},8,["style"])])]),l("div",ue,[g(a(v,{flat:"","no-caps":"",color:"negative",label:"Cancelar"},null,512),[[_]]),a(v,{color:"primary","no-caps":"",label:"Guardar",type:"submit",loading:C.value,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},we=A(ce,[["__scopeId","data-v-fa81c8b5"]]);export{we as default};
