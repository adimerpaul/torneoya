import{_ as T,c as U,o as r,w as a,a as n,b as t,Q as v,e as g,f as u,aa as m,a3 as c,a4 as b,a5 as f,t as s,a2 as C,d as k,Z as x,aq as _,h as E}from"./index-CmoW1HI-.js";import{Q as V}from"./QSpace-CghvMLQs.js";import{Q as S}from"./QPagination-CYKlUxbO.js";import{Q as I}from"./QImg-BFhzNBj4.js";import{Q as w}from"./QMarkupTable-6CKuV8-r.js";import{Q as y}from"./QForm-I0BS1mnk.js";import{Q as N}from"./QSelect-YWvpHr97.js";import{Q}from"./QPage-Dl-a7fNa.js";import{I as P}from"./Imprimir-BmA160f1.js";import"./format-CJebrXOQ.js";import"./QChip-B_XB_8XG.js";import"./QMenu-j9-YnpjT.js";import"./QItemLabel-BiiYZsTs.js";import"./_commonjsHelpers-Bx2EM-6T.js";import"./moment-C5S46NFB.js";const q={name:"VentasNew",data(){return{codigoTipoDocumentoIdentidades:[{value:1,label:"CI - CEDULA DE IDENTIDAD"},{value:2,label:"CEX - CEDULA DE IDENTIDAD DE EXTRANJERO"},{value:5,label:"NIT - NUMERO DE IDENTIFICACION TRIBUTARIA"},{value:3,label:"PAS - PASAPORTE"},{value:4,label:"OD - OTRO DOCUMENTO DE IDENTIDAD"}],loading:!1,ventaDialog:!1,efectivo:"",venta:{nit:"0",nombre:"SN",codigoTipoDocumentoIdentidad:1,tipo_venta:"Interno",tipo_pago:"Efectivo"},pagination:{page:1,rowsPerPage:24,rowsNumber:0},receta_id:null,recognition:null,activeField:null,productos:[],productosSearch:"",productosVentas:[]}},mounted(){this.$nextTick(()=>{this.$refs.inputBuscarProducto?.focus()}),this.productosGet()},methods:{imageUrl(i){const e=i||"uploads/default.png";return`${this.$url}../${e}`},addProducto(i){const e=this.productosVentas.find(D=>D.producto_id===i.id);if(e){e.cantidad=Number(e.cantidad||0)+1;return}this.productosVentas.push({producto_id:i.id,cantidad:1,precio:Number(i.precio||0),producto:i})},searchCliente(){const i=(this.venta.nit||"").toString().trim();if(!i){this.venta.nombre="SN",this.venta.email="",this.venta.codigoTipoDocumentoIdentidad=1,this.venta.complemento="";return}this.loading=!0,this.$axios.post("searchCliente",{nit:i}).then(e=>{this.venta.nombre="SN",this.venta.email="",this.venta.codigoTipoDocumentoIdentidad=1,this.venta.complemento="",e.data?.nombre&&(this.venta.nombre=e.data.nombre),e.data?.email&&(this.venta.email=e.data.email),e.data?.codigoTipoDocumentoIdentidad&&(this.venta.codigoTipoDocumentoIdentidad=parseInt(e.data.codigoTipoDocumentoIdentidad)),e.data?.complemento&&(this.venta.complemento=e.data.complemento)}).catch(e=>console.error(e)).finally(()=>this.loading=!1)},clickDialogVenta(){if(this.productosVentas.length===0){this.$alert?.error?.("Debe agregar al menos un producto a la venta");return}this.ventaDialog=!0,this.efectivo=""},productosGet(){this.loading=!0,this.$axios.get("productosStock",{params:{search:this.productosSearch,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(i=>{this.productos=i.data.data,this.pagination.rowsNumber=i.data.total,this.pagination.page=i.data.current_page,this.productos.length===1&&this.productos[0].barra===this.productosSearch&&(this.addProducto(this.productos[0]),this.productosSearch="")}).catch(i=>{console.error(i)}).finally(()=>{this.loading=!1})},submitVenta(){this.loading=!0,this.$axios.post("ventas",{ci:this.venta.nit,nit:this.venta.nit,nombre:this.venta.nombre,email:this.venta.email,codigoTipoDocumentoIdentidad:this.venta.codigoTipoDocumentoIdentidad,complemento:this.venta.complemento,productos:this.productosVentas,tipo_venta:this.venta.tipo_venta,tipo_pago:this.venta.tipo_pago,receta_id:this.receta_id}).then(i=>{this.ventaDialog=!1,this.$alert?.success?.("Venta realizada con exito"),this.productosVentas=[],this.venta={nit:"0",nombre:"SN",codigoTipoDocumentoIdentidad:1,tipo_venta:"Interno",tipo_pago:"Efectivo"},P.printFactura(i.data),this.receta_id=null,this.$nextTick(()=>this.$refs.inputBuscarProducto?.focus()),this.productosGet()}).catch(i=>{console.error(i),this.$alert?.error?.(i?.response?.data?.message||"No se pudo realizar la venta")}).finally(()=>{this.loading=!1})}},computed:{totalVenta(){return this.productosVentas.reduce((i,e)=>i+Number(e.cantidad)*Number(e.precio),0)},cambio(){let i=Number(this.efectivo||0)-this.totalVenta;return i<0&&(i=0),i.toFixed(2)}}},B={class:"row"},A={class:"col-12 col-md-7 q-pa-xs"},F={class:"flex flex-center"},R={class:"row"},O={class:"absolute-bottom text-center",style:{padding:"0",margin:"0"}},z={style:{"max-width":"190px","line-height":"0.9"}},G={style:{display:"flex","justify-content":"space-between"}},M={class:"text-bold bg-orange text-black border"},L={class:"col-12 col-md-5 q-pa-xs"},X={class:"text-right flex items-center"},j={style:{padding:"0",margin:"0",display:"flex","align-items":"center"}},J={style:{"max-width":"190px",overflow:"hidden","text-overflow":"ellipsis","line-height":".9"}},Z={style:{padding:"0",margin:"0"}},H=["onUpdate:modelValue"],K={style:{padding:"0",margin:"0"}},W=["onUpdate:modelValue"],Y={class:"text-right"},$={class:"text-right text-bold"},tt={class:"row"},et={class:"col-12 col-md-3 q-pa-xs"},ot={class:"col-12 col-md-3 q-pa-xs"},lt={class:"col-12 col-md-3 q-pa-xs"},nt={class:"col-12 col-md-3 q-pa-xs"},it={class:"col-12 col-md-3 q-pa-xs"},at={class:"col-12 col-md-6 q-pa-xs"},st={class:"col-12 q-pa-xs"},dt={style:{padding:"0",margin:"0"}},rt={style:{"max-width":"190px",overflow:"hidden","text-overflow":"ellipsis","line-height":".9"}},ut={class:"text-right"},ct={class:"text-right text-bold"},pt={class:"text-right"},mt={class:"text-right"},ht={class:"col-12 q-pa-xs"};function gt(i,e,D,vt,l,d){return r(),U(Q,{class:"q-pa-xs"},{default:a(()=>[n(v,{flat:"",bordered:""},{default:a(()=>[n(g,{class:"row items-center q-pb-none"},{default:a(()=>[e[13]||(e[13]=t("div",{class:"text-h6"},"Ventas",-1)),n(u,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:e[0]||(e[0]=o=>i.$router.go(-1))}),n(u,{flat:"",round:"",dense:"",icon:"refresh",onClick:d.productosGet,loading:l.loading},null,8,["onClick","loading"]),n(V)]),_:1}),n(g,{class:"q-pa-none"},{default:a(()=>[n(y,{onSubmit:d.clickDialogVenta},{default:a(()=>[t("div",B,[t("div",A,[n(m,{ref:"inputBuscarProducto",modelValue:l.productosSearch,"onUpdate:modelValue":[e[1]||(e[1]=o=>l.productosSearch=o),d.productosGet],outlined:"",clearable:"",label:"Buscar producto",dense:"",debounce:"300"},{append:a(()=>[n(u,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),t("div",F,[n(S,{size:"xs",modelValue:l.pagination.page,"onUpdate:modelValue":[e[2]||(e[2]=o=>l.pagination.page=o),d.productosGet],max:Math.ceil(l.pagination.rowsNumber/l.pagination.rowsPerPage),color:"primary","boundary-numbers":"","max-pages":"5"},null,8,["modelValue","max","onUpdate:modelValue"])]),t("div",R,[(r(!0),c(b,null,f(l.productos,o=>(r(),c("div",{key:o.id,class:"col-6 col-md-2"},[n(v,{flat:"",bordered:"",class:"cursor-pointer",onClick:p=>d.addProducto(o)},{default:a(()=>[n(I,{src:d.imageUrl(o.imagen),class:"q-mb-xs",style:{height:"120px"}},{default:a(()=>[t("div",O,[t("div",z,s(i.$filters.textUpper(o.nombre)),1),t("div",G,[t("span",null,s(o.stock),1),t("span",M,s(o.precio)+" Bs",1)])])]),_:2},1032,["src"])]),_:2},1032,["onClick"])]))),128))])]),t("div",L,[t("div",X,[n(V),n(u,{icon:"delete",size:"10px",color:"red",dense:"",flat:"","no-caps":"",label:"Limpiar",onClick:e[3]||(e[3]=o=>{l.productosVentas=[],l.receta_id=null})})]),n(w,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:a(()=>[e[15]||(e[15]=t("thead",null,[t("tr",null,[t("th",null,"Producto"),t("th",null,"Cantidad"),t("th",null,"Precio"),t("th",null,"Subtotal")])],-1)),t("tbody",null,[(r(!0),c(b,null,f(l.productosVentas,(o,p)=>(r(),c("tr",{key:p},[t("td",j,[n(I,{src:d.imageUrl(o.producto?.imagen),class:"q-mb-xs",style:{height:"35px",width:"35px"}},null,8,["src"]),t("div",J,[n(k,{name:"delete",color:"red",class:"cursor-pointer",onClick:h=>l.productosVentas.splice(p,1)},null,8,["onClick"]),C(" "+s(i.$filters.textUpper(o.producto?.nombre)),1)])]),t("td",Z,[x(t("input",{"onUpdate:modelValue":h=>o.cantidad=h,type:"number",style:{width:"60px"},min:"1"},null,8,H),[[_,o.cantidad,void 0,{number:!0}]])]),t("td",K,[x(t("input",{"onUpdate:modelValue":h=>o.precio=h,type:"number",style:{width:"70px"},step:"0.01"},null,8,W),[[_,o.precio,void 0,{number:!0}]])]),t("td",Y,s((Number(o.cantidad)*Number(o.precio)).toFixed(2))+" Bs ",1)]))),128))]),t("tfoot",null,[t("tr",null,[e[14]||(e[14]=t("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),t("td",$,s(d.totalVenta.toFixed(2))+" Bs ",1)])])]),_:1}),n(u,{label:"Realizar venta",color:"positive",class:"full-width","no-caps":"",loading:l.loading,type:"submit",icon:"add_circle_outline"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1}),n(E,{modelValue:l.ventaDialog,"onUpdate:modelValue":e[12]||(e[12]=o=>l.ventaDialog=o)},{default:a(()=>[n(v,{style:{"max-width":"750px",width:"90vw"}},{default:a(()=>[n(g,{class:"q-pb-none row items-center"},{default:a(()=>[e[16]||(e[16]=t("div",{class:"text-h6"},"Nueva venta",-1)),n(V),n(u,{flat:"",round:"",dense:"",icon:"close",onClick:e[4]||(e[4]=o=>l.ventaDialog=!1)})]),_:1}),n(g,null,{default:a(()=>[n(y,{onSubmit:d.submitVenta},{default:a(()=>[t("div",tt,[t("div",et,[n(m,{modelValue:l.venta.nit,"onUpdate:modelValue":[e[5]||(e[5]=o=>l.venta.nit=o),d.searchCliente],outlined:"",dense:"",label:"CI/NIT",debounce:500},null,8,["modelValue","onUpdate:modelValue"])]),t("div",ot,[n(m,{modelValue:l.venta.nombre,"onUpdate:modelValue":e[6]||(e[6]=o=>l.venta.nombre=o),outlined:"",dense:"",label:"Nombre"},null,8,["modelValue"])]),t("div",lt,[n(m,{modelValue:l.venta.email,"onUpdate:modelValue":e[7]||(e[7]=o=>l.venta.email=o),outlined:"",dense:"",label:"Email"},null,8,["modelValue"])]),t("div",nt,[n(m,{modelValue:l.venta.complemento,"onUpdate:modelValue":e[8]||(e[8]=o=>l.venta.complemento=o),outlined:"",dense:"",label:"Complemento"},null,8,["modelValue"])]),t("div",it,[n(N,{modelValue:l.venta.tipo_pago,"onUpdate:modelValue":e[9]||(e[9]=o=>l.venta.tipo_pago=o),outlined:"",dense:"",label:"Tipo de pago",options:["Efectivo","QR"]},null,8,["modelValue"])]),t("div",at,[n(N,{modelValue:l.venta.codigoTipoDocumentoIdentidad,"onUpdate:modelValue":e[10]||(e[10]=o=>l.venta.codigoTipoDocumentoIdentidad=o),outlined:"",dense:"",label:"Tipo de documento",options:l.codigoTipoDocumentoIdentidades,"emit-value":"","map-options":""},null,8,["modelValue","options"])]),t("div",st,[n(w,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:a(()=>[e[20]||(e[20]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Producto"),t("th",null,"Cant."),t("th",null,"Precio"),t("th",null,"Subtotal")])],-1)),t("tbody",null,[(r(!0),c(b,null,f(l.productosVentas,(o,p)=>(r(),c("tr",{key:"prev-"+p},[t("td",null,s(o.producto_id),1),t("td",dt,[t("div",rt,s(i.$filters.textUpper(o.producto?.nombre||"")),1)]),t("td",null,s(o.cantidad),1),t("td",null,s(Number(o.precio).toFixed(2))+" Bs",1),t("td",ut,s((Number(o.cantidad)*Number(o.precio)).toFixed(2))+" Bs ",1)]))),128))]),t("tfoot",null,[t("tr",null,[e[17]||(e[17]=t("td",{colspan:"4",class:"text-right text-bold"},"Total",-1)),t("td",ct,s(d.totalVenta.toFixed(2))+" Bs",1)]),t("tr",null,[e[18]||(e[18]=t("td",{colspan:"4",class:"text-right text-bold"},"Efectivo",-1)),t("td",pt,[x(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>l.efectivo=o),type:"number",step:"0.01",style:{width:"100px"}},null,512),[[_,l.efectivo,void 0,{number:!0}]])])]),t("tr",null,[e[19]||(e[19]=t("td",{colspan:"4",class:"text-right text-bold"},"Cambio",-1)),t("td",mt,s(d.cambio),1)])])]),_:1})]),t("div",ht,[n(u,{label:"Realizar venta",color:"positive",class:"full-width","no-caps":"",loading:l.loading,type:"submit"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[21]||(e[21]=t("div",{id:"myElement",class:"hidden"},null,-1))]),_:1})}const St=T(q,[["render",gt]]);export{St as default};
