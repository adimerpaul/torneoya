import{_ as M,a0 as Q,c as C,o as _,w as a,a as e,b as o,Q as v,e as u,a3 as x,a1 as N,aa as P,f as b,t as m,a2 as f,a6 as k,a4 as A,a5 as V,d as w}from"./index-CmoW1HI-.js";import{Q as O}from"./QSelect-YWvpHr97.js";import{Q as B}from"./QMarkupTable-6CKuV8-r.js";import{a as D,b as h}from"./QMenu-j9-YnpjT.js";import{Q as L}from"./QList-MksEbVq0.js";import{Q as I}from"./QPage-Dl-a7fNa.js";import{h as Y}from"./moment-C5S46NFB.js";import"./QChip-B_XB_8XG.js";import"./QItemLabel-BiiYZsTs.js";import"./format-CJebrXOQ.js";const R={name:"IndexPage",data(){const s=Y().format("YYYY-MM-DD");return{loading:!1,users:[],filters:{date_from:s,date_to:s,user_id:null},ventas:[],compras:[],pedidos:[],kpis:{ingresos:0,egresos:0,neto:0,efectivo:0,qr:0,ventas:0,pedidos:0,items:0,ticket_promedio:0},chartDaily:{series:[],options:{}},chartPago:{series:[],options:{}},topProductos:[]}},computed:{isAdmin(){return["Admin","Administrador"].includes(this.$store?.user?.role)},userOptions(){return[{label:"Todos",value:null},...this.users.map(s=>({label:s.name,value:s.id}))]}},mounted(){this.usersGet(),this.fetchDashboard()},methods:{setRange(s){const t=Y();s==="today"?(this.filters.date_from=t.format("YYYY-MM-DD"),this.filters.date_to=t.format("YYYY-MM-DD")):s==="week"?(this.filters.date_from=t.startOf("week").format("YYYY-MM-DD"),this.filters.date_to=Y().endOf("week").format("YYYY-MM-DD")):s==="month"&&(this.filters.date_from=t.startOf("month").format("YYYY-MM-DD"),this.filters.date_to=Y().endOf("month").format("YYYY-MM-DD")),this.fetchDashboard()},async usersGet(){if(this.isAdmin)try{const{data:s}=await this.$axios.get("users");this.users=Array.isArray(s)?s:[]}catch{this.users=[]}},async fetchDashboard(){this.loading=!0;try{const s={fechaInicio:this.filters.date_from,fechaFin:this.filters.date_to,user:this.filters.user_id||""},[t,n,c]=await Promise.all([this.$axios.get("ventas",{params:s}),this.$axios.get("compras",{params:s}),this.$axios.get("pedidos",{params:s})]);this.ventas=Array.isArray(t.data)?t.data:[],this.compras=Array.isArray(n.data)?n.data:[],this.pedidos=Array.isArray(c.data)?c.data:[],this.computeKpis(),this.computeCharts(),this.computeTopProductos()}catch(s){this.$alert.error(s?.response?.data?.message||"No se pudo cargar el dashboard")}finally{this.loading=!1}},computeKpis(){const s=this.ventas.filter(i=>(i.estado||"").toLowerCase()==="activo"),t=this.compras.filter(i=>(i.estado||"").toLowerCase()==="activo"),n=s.reduce((i,p)=>i+Number(p.total||0),0),c=t.reduce((i,p)=>i+Number(p.total||0),0),l=s.filter(i=>(i.tipo_pago||"").toLowerCase()==="efectivo").reduce((i,p)=>i+Number(p.total||0),0),d=s.filter(i=>(i.tipo_pago||"").toLowerCase()==="qr").reduce((i,p)=>i+Number(p.total||0),0),g=s.reduce((i,p)=>i+(p.venta_detalles||p.ventaDetalles||[]).reduce((r,y)=>r+Number(y.cantidad||0),0),0);this.kpis={ingresos:n,egresos:c,neto:n-c,efectivo:l,qr:d,ventas:s.length,pedidos:this.pedidos.length,items:g,ticket_promedio:s.length?n/s.length:0}},computeCharts(){const s={},t=(r,y,q)=>{s[r]||(s[r]={ingreso:0,egreso:0}),s[r][y]+=q};this.ventas.filter(r=>(r.estado||"").toLowerCase()==="activo").forEach(r=>t(r.fecha,"ingreso",Number(r.total||0))),this.compras.filter(r=>(r.estado||"").toLowerCase()==="activo").forEach(r=>t(r.fecha,"egreso",Number(r.total||0)));const n=Object.keys(s).sort(),c=n.map(r=>s[r].ingreso),l=n.map(r=>s[r].egreso),d=n.map(r=>s[r].ingreso-s[r].egreso);this.chartDaily={series:[{name:"Ingresos",data:c},{name:"Egresos",data:l},{name:"Neto",data:d}],options:{chart:{toolbar:{show:!1}},stroke:{curve:"smooth",width:3},dataLabels:{enabled:!1},xaxis:{categories:n},tooltip:{y:{formatter:r=>`${this.money(r)} Bs`}},legend:{position:"top"},colors:["#2e7d32","#c62828","#1565c0"]}};const g={};this.ventas.filter(r=>(r.estado||"").toLowerCase()==="activo").forEach(r=>{const y=r.tipo_pago||"OTRO";g[y]=(g[y]||0)+Number(r.total||0)});const i=Object.keys(g),p=i.map(r=>g[r]);this.chartPago={series:p,options:{labels:i,legend:{position:"bottom"},tooltip:{y:{formatter:r=>`${this.money(r)} Bs`}}}}},computeTopProductos(){const s={};this.ventas.filter(t=>(t.estado||"").toLowerCase()==="activo").forEach(t=>{(t.venta_detalles||t.ventaDetalles||[]).forEach(c=>{const l=c?.producto?.nombre||c?.nombre||`Prod ${c.producto_id}`;s[l]||(s[l]={nombre:l,cantidad:0,total:0}),s[l].cantidad+=Number(c.cantidad||0),s[l].total+=Number(c.precio||0)*Number(c.cantidad||0)})}),this.topProductos=Object.values(s).sort((t,n)=>n.cantidad-t.cantidad).slice(0,10)},money(s){return Number(s||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},num(s){return Number(s||0).toLocaleString("es-BO",{maximumFractionDigits:2})}}},S={class:"col-12 col-sm-3 col-md-2"},E={class:"col-12 col-sm-3 col-md-2"},T={key:0,class:"col-12 col-sm-3 col-md-2"},F={class:"col-12 col-sm-3 col-md-2"},j={class:"col-auto"},U={class:"col-auto"},G={class:"col-auto"},H={class:"col-auto"},K={class:"col-auto"},z={class:"col-auto"},J={class:"row q-col-gutter-sm q-mb-sm"},W={class:"col-12 col-sm-6 col-md-3"},X={class:"text-h5 text-weight-bold"},Z={class:"text-caption"},$={class:"col-12 col-sm-6 col-md-3"},tt={class:"text-h5 text-weight-bold"},et={class:"col-12 col-sm-6 col-md-3"},st={class:"text-h5 text-weight-bold"},ot={class:"text-caption"},at={class:"col-12 col-sm-6 col-md-3"},lt={class:"text-h5 text-weight-bold"},it={class:"text-caption"},rt={class:"row q-col-gutter-sm"},dt={class:"col-12 col-md-8"},nt={key:1,class:"text-grey text-center q-pa-md"},ct={class:"col-12 col-md-4"},mt={key:1,class:"text-grey text-center q-pa-md"},ut={class:"row q-col-gutter-sm q-mt-sm"},pt={class:"col-12 col-md-7"},ft={class:"text-right"},ht={class:"text-right"},gt={key:0},_t={class:"col-12 col-md-5"};function vt(s,t,n,c,l,d){const g=Q("apexchart");return _(),C(I,{class:"q-pa-md bg-grey-2"},{default:a(()=>[e(v,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[e(u,{class:"row q-col-gutter-sm items-end"},{default:a(()=>[t[9]||(t[9]=o("div",{class:"col-12 col-md-4"},[o("div",{class:"text-h5 text-weight-bold"},"Dashboard"),o("div",{class:"text-caption text-grey-7"},"Resumen operativo de ventas, compras y pedidos")],-1)),o("div",S,[e(P,{modelValue:l.filters.date_from,"onUpdate:modelValue":t[0]||(t[0]=i=>l.filters.date_from=i),dense:"",outlined:"",label:"Desde",type:"date"},null,8,["modelValue"])]),o("div",E,[e(P,{modelValue:l.filters.date_to,"onUpdate:modelValue":t[1]||(t[1]=i=>l.filters.date_to=i),dense:"",outlined:"",label:"Hasta",type:"date"},null,8,["modelValue"])]),d.isAdmin?(_(),x("div",T,[e(O,{modelValue:l.filters.user_id,"onUpdate:modelValue":t[2]||(t[2]=i=>l.filters.user_id=i),dense:"",outlined:"",clearable:"","emit-value":"","map-options":"",options:d.userOptions,label:"Vendedor"},null,8,["modelValue","options"])])):N("",!0),o("div",F,[e(b,{color:"primary","no-caps":"",icon:"refresh",label:"Actualizar",class:"full-width",loading:l.loading,onClick:d.fetchDashboard},null,8,["loading","onClick"])])]),_:1}),e(u,{class:"q-pt-none row q-col-gutter-sm"},{default:a(()=>[o("div",j,[e(b,{color:"primary",outline:"","no-caps":"",label:"Hoy",onClick:t[3]||(t[3]=i=>d.setRange("today"))})]),o("div",U,[e(b,{color:"primary",outline:"","no-caps":"",label:"Semana",onClick:t[4]||(t[4]=i=>d.setRange("week"))})]),o("div",G,[e(b,{color:"primary",outline:"","no-caps":"",label:"Mes",onClick:t[5]||(t[5]=i=>d.setRange("month"))})]),o("div",H,[e(b,{color:"teal","no-caps":"",icon:"shopping_cart_checkout",label:"Nueva venta",onClick:t[6]||(t[6]=i=>s.$router.push("/ventaNuevo"))})]),o("div",K,[e(b,{color:"orange","no-caps":"",icon:"storefront",label:"Compras",onClick:t[7]||(t[7]=i=>s.$router.push("/compras"))})]),o("div",z,[e(b,{color:"indigo","no-caps":"",icon:"inventory_2",label:"Productos",onClick:t[8]||(t[8]=i=>s.$router.push("/productos"))})])]),_:1})]),_:1}),o("div",J,[o("div",W,[e(v,{flat:"",bordered:"",class:"kpi-card kpi-ingresos"},{default:a(()=>[e(u,null,{default:a(()=>[t[10]||(t[10]=o("div",{class:"text-caption text-grey-7"},"Ingresos",-1)),o("div",X,m(d.money(l.kpis.ingresos))+" Bs",1),o("div",Z,"Efectivo: "+m(d.money(l.kpis.efectivo)),1)]),_:1})]),_:1})]),o("div",$,[e(v,{flat:"",bordered:"",class:"kpi-card kpi-egresos"},{default:a(()=>[e(u,null,{default:a(()=>[t[11]||(t[11]=o("div",{class:"text-caption text-grey-7"},"Egresos",-1)),o("div",tt,m(d.money(l.kpis.egresos))+" Bs",1),t[12]||(t[12]=o("div",{class:"text-caption"},"Compras activas",-1))]),_:1})]),_:1})]),o("div",et,[e(v,{flat:"",bordered:"",class:"kpi-card kpi-neto"},{default:a(()=>[e(u,null,{default:a(()=>[t[13]||(t[13]=o("div",{class:"text-caption text-grey-7"},"Neto",-1)),o("div",st,m(d.money(l.kpis.neto))+" Bs",1),o("div",ot,"QR: "+m(d.money(l.kpis.qr)),1)]),_:1})]),_:1})]),o("div",at,[e(v,{flat:"",bordered:"",class:"kpi-card"},{default:a(()=>[e(u,null,{default:a(()=>[t[14]||(t[14]=o("div",{class:"text-caption text-grey-7"},"Operaciones",-1)),o("div",lt,m(l.kpis.ventas)+" ventas",1),o("div",it,"Pedidos: "+m(l.kpis.pedidos)+" | Items: "+m(l.kpis.items),1)]),_:1})]),_:1})])]),o("div",rt,[o("div",dt,[e(v,{flat:"",bordered:""},{default:a(()=>[e(u,{class:"text-subtitle1 text-weight-bold"},{default:a(()=>t[15]||(t[15]=[f("Movimiento por dia")])),_:1}),e(k),e(u,null,{default:a(()=>[l.chartDaily.series.length?(_(),C(g,{key:0,type:"line",height:"320",options:l.chartDaily.options,series:l.chartDaily.series},null,8,["options","series"])):(_(),x("div",nt,"Sin datos para el rango."))]),_:1})]),_:1})]),o("div",ct,[e(v,{flat:"",bordered:""},{default:a(()=>[e(u,{class:"text-subtitle1 text-weight-bold"},{default:a(()=>t[16]||(t[16]=[f("Ventas por pago")])),_:1}),e(k),e(u,null,{default:a(()=>[l.chartPago.series.length?(_(),C(g,{key:0,type:"donut",height:"320",options:l.chartPago.options,series:l.chartPago.series},null,8,["options","series"])):(_(),x("div",mt,"Sin ventas en el rango."))]),_:1})]),_:1})])]),o("div",ut,[o("div",pt,[e(v,{flat:"",bordered:""},{default:a(()=>[e(u,{class:"text-subtitle1 text-weight-bold"},{default:a(()=>t[17]||(t[17]=[f("Productos mas usados")])),_:1}),e(k),e(u,{class:"q-pa-none"},{default:a(()=>[e(B,{dense:"",flat:"",bordered:""},{default:a(()=>[t[19]||(t[19]=o("thead",null,[o("tr",null,[o("th",null,"Producto"),o("th",{class:"text-right"},"Cantidad"),o("th",{class:"text-right"},"Total")])],-1)),o("tbody",null,[(_(!0),x(A,null,V(l.topProductos,i=>(_(),x("tr",{key:i.nombre},[o("td",null,m(i.nombre),1),o("td",ft,m(d.num(i.cantidad)),1),o("td",ht,m(d.money(i.total)),1)]))),128)),l.topProductos.length===0?(_(),x("tr",gt,t[18]||(t[18]=[o("td",{colspan:"3",class:"text-center text-grey q-pa-md"},"Sin datos",-1)]))):N("",!0)])]),_:1})]),_:1})]),_:1})]),o("div",_t,[e(v,{flat:"",bordered:""},{default:a(()=>[e(u,{class:"text-subtitle1 text-weight-bold"},{default:a(()=>t[20]||(t[20]=[f("Resumen rapido")])),_:1}),e(k),e(L,{dense:""},{default:a(()=>[e(D,null,{default:a(()=>[e(h,{avatar:""},{default:a(()=>[e(w,{name:"sell",color:"primary"})]),_:1}),e(h,null,{default:a(()=>t[21]||(t[21]=[f("Ventas activas")])),_:1}),e(h,{side:"",class:"text-weight-bold"},{default:a(()=>[f(m(l.kpis.ventas),1)]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(h,{avatar:""},{default:a(()=>[e(w,{name:"receipt_long",color:"orange"})]),_:1}),e(h,null,{default:a(()=>t[22]||(t[22]=[f("Pedidos registrados")])),_:1}),e(h,{side:"",class:"text-weight-bold"},{default:a(()=>[f(m(l.kpis.pedidos),1)]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(h,{avatar:""},{default:a(()=>[e(w,{name:"inventory_2",color:"teal"})]),_:1}),e(h,null,{default:a(()=>t[23]||(t[23]=[f("Items vendidos")])),_:1}),e(h,{side:"",class:"text-weight-bold"},{default:a(()=>[f(m(d.num(l.kpis.items)),1)]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(h,{avatar:""},{default:a(()=>[e(w,{name:"point_of_sale",color:"green"})]),_:1}),e(h,null,{default:a(()=>t[24]||(t[24]=[f("Ticket promedio")])),_:1}),e(h,{side:"",class:"text-weight-bold"},{default:a(()=>[f(m(d.money(l.kpis.ticket_promedio))+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1})}const qt=M(R,[["render",vt],["__scopeId","data-v-8bf1871f"]]);export{qt as default};
