import{Q as g}from"./QImg-D78FZSF8.js";import{_ as w,c as f,o as c,w as i,a,b as r,Q as h,e as u,a7 as x,ab as y,af as _,ae as d,d as v,f as b,ad as V,t as p}from"./index-C7LII3He.js";import{Q as T}from"./QFile-CsL8RoTe.js";import{Q as q}from"./QBanner-BsMfyJN7.js";import{Q}from"./QForm-CxqEXIw4.js";import{Q as B}from"./QPage-DDRRcRUa.js";import{Q as P,a as I}from"./QLayout-Cw7S_Y1_.js";import"./format-Dfgb_3-_.js";import"./QResizeObserver-B5KVCFjh.js";const U={name:"RegisterTorneoYa",data(){return{loading:!1,showPassword:!1,avatarPreview:null,avatarInfo:{sizeText:"Sin archivo",dimensionsText:"-",typeText:"-"},form:{name:"",username:"",email:"",password:"",telefono_contacto_1:"",avatar:null}}},computed:{year(){return new Date().getFullYear()}},beforeUnmount(){this.avatarPreview&&URL.revokeObjectURL(this.avatarPreview)},methods:{req(s){return!!s||"Campo requerido"},formatBytes(s){if(!s)return"0 B";const e=["B","KB","MB","GB"],o=Math.floor(Math.log(s)/Math.log(1024)),n=s/Math.pow(1024,o);return`${n.toFixed(n>=10?0:1)} ${e[o]}`},async onAvatarSelected(s){if(this.avatarPreview&&(URL.revokeObjectURL(this.avatarPreview),this.avatarPreview=null),!s){this.avatarInfo={sizeText:"Sin archivo",dimensionsText:"-",typeText:"-"};return}const e=2*1024*1024;if(s.size>e){this.$alert?.error?.("La imagen supera 2 MB. Elige una mas liviana."),this.form.avatar=null,this.avatarInfo={sizeText:this.formatBytes(s.size),dimensionsText:"-",typeText:s.type||"-"};return}this.avatarPreview=URL.createObjectURL(s),this.avatarInfo.sizeText=this.formatBytes(s.size),this.avatarInfo.typeText=s.type||"-";const o=new Image;o.onload=()=>{this.avatarInfo.dimensionsText=`${o.width} x ${o.height}px`},o.onerror=()=>{this.avatarInfo.dimensionsText="No disponible"},o.src=this.avatarPreview},register(){this.loading=!0;const s=new FormData;s.append("name",this.form.name),s.append("username",this.form.username),s.append("password",this.form.password),s.append("telefono_contacto_1",this.form.telefono_contacto_1),this.form.email&&s.append("email",this.form.email),this.form.avatar&&s.append("avatar",this.form.avatar),this.$axios.post("/register",s,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{const{user:o,token:n}=e.data;this.$axios.defaults.headers.common.Authorization=`Bearer ${n}`,this.$store&&(this.$store.isLogged=!0,this.$store.user=o,this.$store.permissions=(o.permissions||[]).map(t=>t.name)),localStorage.setItem("tokenTorneoya",n),localStorage.setItem("user",JSON.stringify(o)),this.$alert?.success?.("Registro exitoso. Bienvenido."),this.$router.push("/")}).catch(e=>{const o=e?.response?.data,t=(o?.errors?Object.values(o.errors)[0]?.[0]:null)||o?.message||"No se pudo registrar el usuario";this.$alert?.error?.(t,"Error")}).finally(()=>{this.loading=!1})}}},S={class:"register-wrap"},z={class:"row q-col-gutter-md"},C={class:"col-12 col-md-8"},k={class:"row q-gutter-sm"},R={class:"col-12 col-md-4"},L={class:"row justify-center q-mb-sm"},M={class:"text-caption text-grey-8"},N={class:"text-caption text-grey-8"},j={class:"text-caption text-grey-8"},A={class:"text-caption text-grey-6"};function F(s,e,o,n,t,m){return c(),f(I,{class:"register-layout"},{default:i(()=>[a(P,null,{default:i(()=>[a(B,{class:"full-height"},{default:i(()=>[e[12]||(e[12]=r("div",{class:"register-bg-overlay"},null,-1)),r("div",S,[a(h,{flat:"",bordered:"",class:"register-card"},{default:i(()=>[a(u,{class:"q-pt-lg text-center"},{default:i(()=>[a(g,{src:"logo.png",width:"96px",ratio:"1",fit:"contain"}),e[8]||(e[8]=r("div",{class:"text-subtitle2 text-grey-7 brand-chip q-mt-sm"},[r("b",null,"Torneo Ya"),x(" - Crea tus torneos ")],-1))]),_:1}),a(y,{spaced:""}),a(u,null,{default:i(()=>[e[11]||(e[11]=r("div",{class:"text-h6 text-bold q-mb-sm"},"Registro",-1)),r("div",z,[r("div",C,[a(Q,{onSubmit:_(m.register,["prevent"])},{default:i(()=>[a(d,{modelValue:t.form.name,"onUpdate:modelValue":e[0]||(e[0]=l=>t.form.name=l),outlined:"",dense:"",label:"Nombre",rules:[m.req],class:"q-mb-sm"},null,8,["modelValue","rules"]),a(d,{modelValue:t.form.username,"onUpdate:modelValue":e[1]||(e[1]=l=>t.form.username=l),outlined:"",dense:"",label:"Username",rules:[m.req],class:"q-mb-sm"},null,8,["modelValue","rules"]),a(d,{modelValue:t.form.email,"onUpdate:modelValue":e[2]||(e[2]=l=>t.form.email=l),outlined:"",dense:"",type:"email",label:"Gmail (opcional)",class:"q-mb-sm"},null,8,["modelValue"]),a(d,{modelValue:t.form.password,"onUpdate:modelValue":e[4]||(e[4]=l=>t.form.password=l),outlined:"",dense:"",type:t.showPassword?"text":"password",label:"Clave",rules:[m.req],class:"q-mb-sm"},{append:i(()=>[a(v,{name:t.showPassword?"visibility":"visibility_off",class:"cursor-pointer",onClick:e[3]||(e[3]=l=>t.showPassword=!t.showPassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),a(d,{modelValue:t.form.telefono_contacto_1,"onUpdate:modelValue":e[5]||(e[5]=l=>t.form.telefono_contacto_1=l),outlined:"",dense:"",label:"Telefono de contacto",rules:[m.req],class:"q-mb-sm"},null,8,["modelValue","rules"]),a(T,{modelValue:t.form.avatar,"onUpdate:modelValue":[e[6]||(e[6]=l=>t.form.avatar=l),m.onAvatarSelected],outlined:"",dense:"",label:"Avatar",accept:"image/jpeg,image/png,image/webp",class:"q-mb-sm"},{prepend:i(()=>[a(v,{name:"image"})]),_:1},8,["modelValue","onUpdate:modelValue"]),a(q,{dense:"",class:"bg-blue-1 text-blue-9 q-mb-md",rounded:""},{default:i(()=>[...e[9]||(e[9]=[x(" Avatar recomendado: hasta 2 MB. Se guarda comprimido en WEBP (256x256). ",-1)])]),_:1}),r("div",k,[a(b,{color:"primary",unelevated:"","no-caps":"",loading:t.loading,label:"Crear cuenta",type:"submit"},null,8,["loading"]),a(b,{outline:"",color:"primary","no-caps":"",label:"Volver a login",onClick:e[7]||(e[7]=l=>s.$router.push("/login"))})])]),_:1},8,["onSubmit"])]),r("div",R,[a(h,{flat:"",bordered:"",class:"preview-card"},{default:i(()=>[a(u,null,{default:i(()=>[e[10]||(e[10]=r("div",{class:"text-subtitle2 text-weight-medium q-mb-sm"},"Vista previa del avatar",-1)),r("div",L,[a(V,{size:"110px",class:"shadow-2"},{default:i(()=>[t.avatarPreview?(c(),f(g,{key:0,src:t.avatarPreview},null,8,["src"])):(c(),f(v,{key:1,name:"person",size:"42px"}))]),_:1})]),r("div",M,"Peso: "+p(t.avatarInfo.sizeText),1),r("div",N,"Dimensiones: "+p(t.avatarInfo.dimensionsText),1),r("div",j,"Formato: "+p(t.avatarInfo.typeText),1)]),_:1})]),_:1})])])]),_:1}),a(u,{class:"text-center q-pt-none"},{default:i(()=>[r("div",A,"(c) "+p(m.year)+" Torneo Ya",1)]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})}const X=w(U,[["render",F],["__scopeId","data-v-b44793b6"]]);export{X as default};
