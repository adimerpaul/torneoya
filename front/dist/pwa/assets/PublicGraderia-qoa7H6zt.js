import{Q as v}from"./QSpace-D9phzHsB.js";import{_ as B,c as R,o as u,w as a,a as o,Q as E,e as h,b as e,t as i,G as g,H as _,I as Q,f as D,J as y,F as O,K as w,L}from"./index-BCqWixgG.js";import{Q as m}from"./QBanner-B_-Jc-wH.js";import{Q as b}from"./QChip-Cr7WtGSR.js";import{Q as S}from"./QBadge-BcDNLmI8.js";import{Q as q}from"./QPage-CCnFDat8.js";const N={name:"PublicGraderia",data(){return{loading:!1,graderia:null,asientos:[],seatMap:{},statusMeta:{NO_GENERADO:{label:"No generado",color:"grey-7",bg:"#e6e6e6"},LIBRE:{label:"Libre",color:"positive",bg:"#82f38b"},RESERVADO:{label:"Reservado",color:"warning",bg:"#f3d77d"},PAGADO:{label:"Pagado",color:"primary",bg:"#79bcee"},BLOQUEADO:{label:"Bloqueado",color:"negative",bg:"#ec7385"}}}},computed:{code(){return this.$route.params.code},stats(){const t={total:Number(this.graderia?.filas||0)*Number(this.graderia?.columnas||0),libre:0,reservado:0,pagado:0,bloqueado:0,ocupado:0};for(const c of this.asientos){const d=this.normalizeEstado(c.estado)||"LIBRE";d==="LIBRE"&&t.libre++,d==="RESERVADO"&&t.reservado++,d==="PAGADO"&&t.pagado++,d==="BLOQUEADO"&&t.bloqueado++}return t.ocupado=t.reservado+t.pagado+t.bloqueado,t},gridSeats(){if(!this.graderia)return[];const s=Number(this.graderia.filas||0),t=Number(this.graderia.columnas||0);if(s<=0||t<=0)return[];const c=this.graderia.start_top?this.range(1,s):this.range(1,s).reverse(),d=this.graderia.start_left?this.range(1,t):this.range(1,t).reverse(),r=[];for(const l of c){const f=[];for(const p of d){const n=this.makeCode(l,p),x=this.seatMap[n]||null,A=x?this.normalizeEstado(x.estado)||"LIBRE":"NO_GENERADO";f.push({codigo:n,status:A})}r.push(f)}return r}},mounted(){this.load()},methods:{load(){this.code&&(this.loading=!0,this.$axios.get(`public/graderias/${this.code}`).then(s=>{const t=s.data;this.graderia=t.graderia,this.asientos=t.asientos||[];const c={};for(const d of this.asientos)c[d.codigo]=d;this.seatMap=c}).catch(()=>{this.$alert?.error?.("No se pudo cargar la graderÃ­a")}).finally(()=>{this.loading=!1}))},normalizeEstado(s){if(!s)return"";const t=String(s).toUpperCase();return["LIBRE","RESERVADO","PAGADO","BLOQUEADO"].includes(t)?t:""},range(s,t){const c=[];for(let d=s;d<=t;d++)c.push(d);return c},numToLetters(s){let t="";for(s=Number(s);s>0;)s--,t=String.fromCharCode(65+s%26)+t,s=Math.floor(s/26);return t},makeCode(s,t){return String(this.graderia.etiqueta_modo)==="fila"?`${this.numToLetters(s)}${t}`:`${this.numToLetters(t)}${s}`},seatBg(s){return this.statusMeta[s.status]?.bg||"#ffffff"},cellStyle(){return{textAlign:"center",opacity:1}}}},k={class:"text-subtitle1 text-weight-bold"},C={class:"text-caption text-grey-7"},M={key:0},G={class:"row q-col-gutter-xs"},P={class:"col-6 col-md-3"},V={class:"text-subtitle1 text-weight-bold"},I={class:"col-6 col-md-3"},T={class:"text-subtitle1 text-weight-bold"},U={class:"col-6 col-md-3"},z={class:"text-subtitle1 text-weight-bold"},F={class:"col-6 col-md-3"},H={class:"text-subtitle1 text-weight-bold"},J={class:"row q-col-gutter-xs q-mt-xs"},K={class:"col-12 col-md-3"},j={class:"col-12 col-md-3"},W={class:"col-12 col-md-3"},X={class:"col-12 col-md-3"},Y={style:{width:"100%",overflow:"auto"}},Z={border:"1",cellpadding:"6",cellspacing:"0",width:"100%"},$=["bgcolor"],tt={class:"text-weight-bold"},et={style:{"font-size":"11px"}};function st(s,t,c,d,r,l){return u(),R(q,{class:"q-pa-sm"},{default:a(()=>[o(E,{flat:"",bordered:""},{default:a(()=>[o(h,{class:"row items-center q-py-sm"},{default:a(()=>[e("div",null,[e("div",k,i(r.graderia?.nombre||"Graderias"),1),e("div",C,[g(i(r.graderia?.direccion||"")+" ",1),r.graderia?.user?.telefono_contacto_1||r.graderia?.user?.telefono_contacto_2?(u(),_("span",M," - Contacto: "+i(r.graderia.user.telefono_contacto_1)+" "+i(r.graderia.user.telefono_contacto_2),1)):Q("",!0)])]),o(v),o(D,{dense:"","no-caps":"",color:"primary",icon:"refresh",label:"Recargar",loading:r.loading,onClick:t[0]||(t[0]=f=>l.load())},null,8,["loading"])]),_:1}),o(y),o(h,{class:"q-pa-sm"},{default:a(()=>[e("div",G,[e("div",P,[o(m,{dense:"",class:"bg-grey-1"},{default:a(()=>[t[1]||(t[1]=e("div",{class:"text-caption text-grey-7"},"Total asientos",-1)),e("div",V,i(l.stats.total),1)]),_:1})]),e("div",I,[o(m,{dense:"",class:"bg-grey-1"},{default:a(()=>[t[2]||(t[2]=e("div",{class:"text-caption text-grey-7"},"Disponibles",-1)),e("div",T,i(l.stats.libre),1)]),_:1})]),e("div",U,[o(m,{dense:"",class:"bg-grey-1"},{default:a(()=>[t[3]||(t[3]=e("div",{class:"text-caption text-grey-7"},"Reservados",-1)),e("div",z,i(l.stats.reservado),1)]),_:1})]),e("div",F,[o(m,{dense:"",class:"bg-grey-1"},{default:a(()=>[t[4]||(t[4]=e("div",{class:"text-caption text-grey-7"},"Pagados/Bloqueados",-1)),e("div",H,i(l.stats.ocupado),1)]),_:1})])]),e("div",J,[e("div",K,[o(b,{dense:"",color:r.statusMeta.LIBRE.color,"text-color":"white",icon:"event_seat"},{default:a(()=>[g(" LIBRE: "+i(l.stats.libre),1)]),_:1},8,["color"])]),e("div",j,[o(b,{dense:"",color:r.statusMeta.RESERVADO.color,"text-color":"white",icon:"bookmark"},{default:a(()=>[g(" RESERVADO: "+i(l.stats.reservado),1)]),_:1},8,["color"])]),e("div",W,[o(b,{dense:"",color:r.statusMeta.PAGADO.color,"text-color":"white",icon:"paid"},{default:a(()=>[g(" PAGADO: "+i(l.stats.pagado),1)]),_:1},8,["color"])]),e("div",X,[o(b,{dense:"",color:r.statusMeta.BLOQUEADO.color,"text-color":"white",icon:"block"},{default:a(()=>[g(" BLOQUEADO: "+i(l.stats.bloqueado),1)]),_:1},8,["color"])])])]),_:1})]),_:1}),o(E,{flat:"",bordered:"",class:"q-mt-sm"},{default:a(()=>[o(h,{class:"row items-center q-py-sm"},{default:a(()=>[t[5]||(t[5]=e("div",{class:"text-subtitle2 text-weight-bold"},"Mapa de asientos",-1)),o(v),o(S,{outline:"",color:"primary"},{default:a(()=>[g(" Total "+i(l.stats.total)+" asientos ",1)]),_:1})]),_:1}),o(y),o(h,{class:"q-pa-sm"},{default:a(()=>[e("div",Y,[e("table",Z,[e("tbody",null,[(u(!0),_(O,null,w(l.gridSeats,(f,p)=>(u(),_("tr",{key:p},[(u(!0),_(O,null,w(f,n=>(u(),_("td",{key:n.codigo,bgcolor:l.seatBg(n),style:L(l.cellStyle(n))},[e("div",tt,i(n.codigo),1),e("div",et,i(r.statusMeta[n.status].label),1)],12,$))),128))]))),128))])])])]),_:1})]),_:1})]),_:1})}const ct=B(N,[["render",st]]);export{ct as default};
