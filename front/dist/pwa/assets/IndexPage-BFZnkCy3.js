import{_ as E,E as Q,c as q,o as A,w as o,b as e,a as s,ag as k,d as I,f as _,Q as m,e as n,ae as h,t as p,G as u,J as b,I as T}from"./index-BCqWixgG.js";import{Q as v}from"./QSpace-D9phzHsB.js";import{Q as S}from"./QBadge-BcDNLmI8.js";import{Q as x}from"./QChip-Cr7WtGSR.js";import{Q as D}from"./QBanner-B_-Jc-wH.js";import{Q as N,a as w}from"./QTable-Dacp_sJ1.js";import{Q as V}from"./QPage-CCnFDat8.js";import"./format-DaA42lUg.js";import"./QSelect-DrQ4uTqS.js";const B={name:"IndexPage",data(){return{loading:!1,loadingEstados:!1,filter:"",topN:8,graderias:[],estadosHint:"Se calcula consultando /mis-graderias/{id}/venta (uno por gradería). Si tienes muchas graderías, puedes optimizar con un endpoint agregado.",columns:[{name:"nombre",label:"Gradería",field:"nombre",align:"left",sortable:!0},{name:"direccion",label:"Dirección",field:"direccion",align:"left",sortable:!0},{name:"filas",label:"Filas",field:"filas",align:"center",sortable:!0},{name:"columnas",label:"Cols",field:"columnas",align:"center",sortable:!0},{name:"capacidad",label:"Capacidad",field:a=>a.capacidad_total,align:"right",sortable:!0},{name:"activo",label:"Estado",field:"activo",align:"left",sortable:!0},{name:"acciones",label:"",field:"id",align:"right"}],estadosTopLabels:[],estadosTopCounts:{libre:[],reservado:[],pagado:[],bloqueado:[]}}},computed:{rowsFiltered(){const a=(this.filter||"").trim().toUpperCase();return a?this.graderias.filter(t=>(t.nombre||"").toUpperCase().includes(a)||(t.direccion||"").toUpperCase().includes(a)||(t.codigo||"").toUpperCase().includes(a)):this.graderias},kpis(){const a=this.graderias.length,t=this.graderias.filter(d=>!!d.activo).length;let r=0;for(const d of this.graderias)r+=this.capacidadDe(d);let c=0;return c+=(this.estadosTopCounts.reservado||[]).reduce((d,i)=>d+(Number(i)||0),0),c+=(this.estadosTopCounts.pagado||[]).reduce((d,i)=>d+(Number(i)||0),0),c+=(this.estadosTopCounts.bloqueado||[]).reduce((d,i)=>d+(Number(i)||0),0),{total:a,activas:t,capacidadTotal:r,ocupadosAprox:c}},donutSeries(){const a=this.kpis.activas,t=this.kpis.total-a;return[a,t]},donutOptions(){return{labels:["Activas","Inactivas"],legend:{position:"bottom"},dataLabels:{enabled:!0},stroke:{show:!1},plotOptions:{pie:{donut:{size:"72%"}}}}},capSeries(){return[{name:"Capacidad",data:this.topCapacidad().map(a=>a.capacidad)}]},capOptions(){return{chart:{toolbar:{show:!1}},xaxis:{categories:this.topCapacidad().map(a=>a.nombre)},plotOptions:{bar:{borderRadius:6,columnWidth:"55%"}},dataLabels:{enabled:!1},tooltip:{y:{formatter:a=>this.fmtInt(a)}}}},estadoSeries(){return[{name:"LIBRE",data:this.estadosTopCounts.libre||[]},{name:"RESERVADO",data:this.estadosTopCounts.reservado||[]},{name:"PAGADO",data:this.estadosTopCounts.pagado||[]},{name:"BLOQUEADO",data:this.estadosTopCounts.bloqueado||[]}]},estadoOptions(){return{chart:{stacked:!0,toolbar:{show:!1}},plotOptions:{bar:{borderRadius:6,columnWidth:"55%"}},xaxis:{categories:this.estadosTopLabels||[]},dataLabels:{enabled:!1},legend:{position:"bottom"},tooltip:{y:{formatter:a=>this.fmtInt(a)}}}}},mounted(){this.load()},methods:{async load(){this.loading=!0;try{const{data:a}=await this.$axios.get("mis-graderias"),t=Array.isArray(a)?a:a.data||[];this.graderias=t,await this.loadEstadosAsientos()}catch(a){this.$alert?.error?.(a.response?.data?.message||"No se pudo cargar graderías")}finally{this.loading=!1}},capacidadDe(a){const t=Number(a?.capacidad_total||0);if(t>0)return t;const r=Number(a?.filas||0),c=Number(a?.columnas||0);return Math.max(0,r*c)},topCapacidad(){const a=(this.rowsFiltered||[]).map(t=>({id:t.id,nombre:t.nombre||`#${t.id}`,capacidad:this.capacidadDe(t)}));return a.sort((t,r)=>r.capacidad-t.capacidad),a.slice(0,this.topN)},fmtInt(a){return Number(a||0).toLocaleString("es-BO")},goVenta(a){this.$router.push(`/mis-graderias/${a.id}/venta`)},async loadEstadosAsientos(){const a=this.topCapacidad();if(a.length){this.loadingEstados=!0;try{const t=[],r=[],c=[],d=[],i=[];for(const f of a){t.push(f.nombre);try{const{data:l}=await this.$axios.get(`mis-graderias/${f.id}/venta`),y=l.asientos||[],g={LIBRE:0,RESERVADO:0,PAGADO:0,BLOQUEADO:0};for(const O of y){const C=String(O.estado||"LIBRE").toUpperCase();g[C]!==void 0&&g[C]++}r.push(g.LIBRE),c.push(g.RESERVADO),d.push(g.PAGADO),i.push(g.BLOQUEADO)}catch{r.push(0),c.push(0),d.push(0),i.push(0)}}this.estadosTopLabels=t,this.estadosTopCounts={libre:r,reservado:c,pagado:d,bloqueado:i}}finally{this.loadingEstados=!1}}}}},L={class:"row items-center q-mb-md"},R={class:"col-12 col-md-5"},U={class:"row items-center justify-end q-col-gutter-sm"},P={class:"col-12 col-sm-7"},z={class:"col-12 col-sm-5"},G={class:"row q-col-gutter-md"},F={class:"col-12 col-sm-6 col-md-3"},H={class:"q-ml-md"},M={class:"text-h6 text-weight-bold"},W={class:"col-12 col-sm-6 col-md-3"},j={class:"q-ml-md"},J={class:"text-h6 text-weight-bold"},K={class:"col-12 col-sm-6 col-md-3"},X={class:"q-ml-md"},Y={class:"text-h6 text-weight-bold"},Z={class:"col-12 col-sm-6 col-md-3"},$={class:"q-ml-md"},tt={class:"text-h6 text-weight-bold"},st={class:"row q-col-gutter-md q-mt-md"},et={class:"col-12 col-md-4"},at={class:"col-12 col-md-8"},ot={class:"row q-col-gutter-md q-mt-md"},it={class:"col-12"},dt={class:"text-caption text-grey-7"},lt={class:"row q-col-gutter-md q-mt-md"},rt={class:"col-12"};function ct(a,t,r,c,d,i){const f=Q("apexchart");return A(),q(V,{class:"q-pa-md bg-grey-2"},{default:o(()=>[e("div",L,[t[3]||(t[3]=e("div",{class:"col-12 col-md-7"},[e("div",{class:"text-h5 text-weight-bold"},"Dashboard — Mis graderías"),e("div",{class:"text-caption text-grey-7"}," Resumen de capacidad, estado y ocupación. ")],-1)),e("div",R,[e("div",U,[e("div",P,[s(k,{modelValue:d.filter,"onUpdate:modelValue":t[0]||(t[0]=l=>d.filter=l),dense:"",outlined:"",debounce:"250",label:"Buscar gradería...",clearable:""},{prepend:o(()=>[s(I,{name:"search"})]),_:1},8,["modelValue"])]),e("div",z,[s(_,{class:"full-width",color:"primary",icon:"refresh","no-caps":"",loading:d.loading,label:"Recargar",onClick:t[1]||(t[1]=l=>i.load())},null,8,["loading"])])])])]),e("div",G,[e("div",F,[s(m,{flat:"",bordered:""},{default:o(()=>[s(n,{class:"row items-center"},{default:o(()=>[s(h,{size:"42px",color:"primary","text-color":"white",icon:"stadium"}),e("div",H,[t[4]||(t[4]=e("div",{class:"text-caption text-grey-7"},"Graderías",-1)),e("div",M,p(i.kpis.total),1)])]),_:1})]),_:1})]),e("div",W,[s(m,{flat:"",bordered:""},{default:o(()=>[s(n,{class:"row items-center"},{default:o(()=>[s(h,{size:"42px",color:"positive","text-color":"white",icon:"check_circle"}),e("div",j,[t[5]||(t[5]=e("div",{class:"text-caption text-grey-7"},"Activas",-1)),e("div",J,p(i.kpis.activas),1)])]),_:1})]),_:1})]),e("div",K,[s(m,{flat:"",bordered:""},{default:o(()=>[s(n,{class:"row items-center"},{default:o(()=>[s(h,{size:"42px",color:"grey-8","text-color":"white",icon:"grid_on"}),e("div",X,[t[6]||(t[6]=e("div",{class:"text-caption text-grey-7"},"Capacidad total",-1)),e("div",Y,p(i.fmtInt(i.kpis.capacidadTotal)),1)])]),_:1})]),_:1})]),e("div",Z,[s(m,{flat:"",bordered:""},{default:o(()=>[s(n,{class:"row items-center"},{default:o(()=>[s(h,{size:"42px",color:"warning","text-color":"white",icon:"local_activity"}),e("div",$,[t[7]||(t[7]=e("div",{class:"text-caption text-grey-7"},"Ocupados (aprox)",-1)),e("div",tt,p(i.fmtInt(i.kpis.ocupadosAprox)),1)])]),_:1})]),_:1})])]),e("div",st,[e("div",et,[s(m,{flat:"",bordered:""},{default:o(()=>[s(n,{class:"row items-center q-py-sm"},{default:o(()=>[t[8]||(t[8]=e("div",{class:"text-subtitle1 text-weight-bold"},"Estado de graderías",-1)),s(v),s(S,{outline:"",color:"primary"},{default:o(()=>[u(p(i.kpis.total)+" total",1)]),_:1})]),_:1}),s(b),s(n,{class:"q-pa-sm"},{default:o(()=>[s(f,{type:"donut",height:"280",options:i.donutOptions,series:i.donutSeries},null,8,["options","series"]),t[9]||(t[9]=e("div",{class:"text-caption text-grey-7 q-mt-sm"},[u(" Activas vs Inactivas según el campo "),e("b",null,"activo"),u(". ")],-1))]),_:1})]),_:1})]),e("div",at,[s(m,{flat:"",bordered:""},{default:o(()=>[s(n,{class:"row items-center q-py-sm"},{default:o(()=>[t[10]||(t[10]=e("div",{class:"text-subtitle1 text-weight-bold"},"Capacidad por gradería",-1)),s(v),s(x,{dense:"",outline:"",icon:"bar_chart",color:"primary"},{default:o(()=>[u("Top "+p(d.topN),1)]),_:1})]),_:1}),s(b),s(n,{class:"q-pa-sm"},{default:o(()=>[s(f,{type:"bar",height:"280",options:i.capOptions,series:i.capSeries},null,8,["options","series"]),t[11]||(t[11]=e("div",{class:"text-caption text-grey-7 q-mt-sm"},[u(" Usa "),e("b",null,"capacidad_total"),u(" (si está vacío, se calcula filas × columnas). ")],-1))]),_:1})]),_:1})])]),e("div",ot,[e("div",it,[s(m,{flat:"",bordered:""},{default:o(()=>[s(n,{class:"row items-center q-py-sm"},{default:o(()=>[t[12]||(t[12]=e("div",{class:"text-subtitle1 text-weight-bold"},"Estados de asientos (top)",-1)),s(v),s(_,{dense:"",flat:"",icon:"insights","no-caps":"",label:"Recalcular estados",loading:d.loadingEstados,onClick:t[2]||(t[2]=l=>i.loadEstadosAsientos())},null,8,["loading"])]),_:1}),s(b),s(n,{class:"q-pa-sm"},{default:o(()=>[d.estadosHint?(A(),q(D,{key:0,dense:"",class:"bg-grey-1 q-mb-sm"},{default:o(()=>[e("div",dt,p(d.estadosHint),1)]),_:1})):T("",!0),s(f,{type:"bar",height:"320",options:i.estadoOptions,series:i.estadoSeries},null,8,["options","series"])]),_:1})]),_:1})])]),e("div",lt,[e("div",rt,[s(m,{flat:"",bordered:""},{default:o(()=>[s(n,{class:"row items-center q-py-sm"},{default:o(()=>[t[14]||(t[14]=e("div",{class:"text-subtitle1 text-weight-bold"},"Listado",-1)),s(v),s(x,{dense:"",outline:"",icon:"info",color:"grey-8"},{default:o(()=>[...t[13]||(t[13]=[u(" Click en “Ver” para administrar asientos ",-1)])]),_:1})]),_:1}),s(b),s(N,{flat:"",bordered:"",dense:"",rows:i.rowsFiltered,columns:d.columns,"row-key":"id",pagination:{rowsPerPage:10}},{"body-cell_activo":o(l=>[s(w,{props:l},{default:o(()=>[s(x,{dense:"",color:l.row.activo?"positive":"grey-7","text-color":"white"},{default:o(()=>[u(p(l.row.activo?"ACTIVO":"INACTIVO"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell_capacidad":o(l=>[s(w,{props:l,class:"text-right"},{default:o(()=>[u(p(i.fmtInt(i.capacidadDe(l.row))),1)]),_:2},1032,["props"])]),"body-cell_acciones":o(l=>[s(w,{props:l,class:"text-right"},{default:o(()=>[s(_,{dense:"","no-caps":"",color:"primary",icon:"event_seat",label:"Ver",onClick:y=>i.goVenta(l.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})])])]),_:1})}const _t=E(B,[["render",ct]]);export{_t as default};
