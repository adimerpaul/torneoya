import{Q as c}from"./QSpace-BwcNFRTt.js";import{_ as f,c as w,o as b,w as a,b as t,a as s,Q as u,e as l,d as p,ab as g,af as C,ae as d,f as i,a7 as v,h as y,ah as h,a3 as _}from"./index-CyiBagph.js";import{Q as x}from"./QBanner-w49iy8QC.js";import{Q}from"./QForm-Gzwx4hF_.js";import{Q as V}from"./QPage-Ds63GZrV.js";import{C as q}from"./ClosePopup-Dn3O3y_r.js";const k={name:"CambiarContrasena",data(){return{loading:!1,confirmDialog:!1,showCurrent:!1,showNew:!1,showConfirm:!1,form:{current_password:"",password:"",password_confirmation:""}}},methods:{openConfirmDialog(){if(!this.form.current_password||!this.form.password||!this.form.password_confirmation){this.$alert.error("Completa todos los campos");return}if(this.form.password!==this.form.password_confirmation){this.$alert.error("La confirmacion no coincide");return}this.confirmDialog=!0},async submit(){this.loading=!0;try{await this.$axios.post("/me/password/update",this.form),this.$alert.success("Contrasena actualizada. Inicia sesion nuevamente."),this.confirmDialog=!1,this.$store.isLogged=!1,this.$store.user={},this.$store.permissions=[],localStorage.removeItem("tokenTicket"),localStorage.removeItem("user"),this.$router.push("/login")}catch(n){this.$alert.error(n.response?.data?.message||"No se pudo cambiar la contrasena")}finally{this.loading=!1}}}},N={class:"row justify-center"},D={class:"col-12 col-md-6"},S={class:"row q-col-gutter-sm"},z={class:"col-12 col-sm-6"},B={class:"col-12 col-sm-6"};function I(n,o,U,L,e,m){return b(),w(V,{class:"q-pa-md bg-grey-2"},{default:a(()=>[t("div",N,[t("div",D,[s(u,{flat:"",bordered:""},{default:a(()=>[s(l,{class:"row items-center q-py-sm"},{default:a(()=>[o[8]||(o[8]=t("div",null,[t("div",{class:"text-h6 text-weight-bold"},"Cambiar contrasena"),t("div",{class:"text-caption text-grey-7"}," Actualiza tu acceso de forma segura. ")],-1)),s(c),s(p,{name:"vpn_key",color:"primary",size:"28px"})]),_:1}),s(g),s(l,{class:"q-pa-md"},{default:a(()=>[s(Q,{onSubmit:C(m.openConfirmDialog,["prevent"])},{default:a(()=>[s(d,{modelValue:e.form.current_password,"onUpdate:modelValue":o[1]||(o[1]=r=>e.form.current_password=r),dense:"",outlined:"",type:e.showCurrent?"text":"password",label:"Contrasena actual",autocomplete:"current-password",class:"q-mb-sm",rules:[r=>!!r||"Requerido"]},{append:a(()=>[s(i,{dense:"",flat:"",round:"",type:"button",icon:e.showCurrent?"visibility":"visibility_off",onClick:o[0]||(o[0]=r=>e.showCurrent=!e.showCurrent)},null,8,["icon"])]),_:1},8,["modelValue","type","rules"]),s(d,{modelValue:e.form.password,"onUpdate:modelValue":o[3]||(o[3]=r=>e.form.password=r),dense:"",outlined:"",type:e.showNew?"text":"password",label:"Nueva contrasena",autocomplete:"new-password",class:"q-mb-sm",rules:[r=>r&&r.length>=6||"Minimo 6 caracteres"]},{append:a(()=>[s(i,{dense:"",flat:"",round:"",type:"button",icon:e.showNew?"visibility":"visibility_off",onClick:o[2]||(o[2]=r=>e.showNew=!e.showNew)},null,8,["icon"])]),_:1},8,["modelValue","type","rules"]),s(d,{modelValue:e.form.password_confirmation,"onUpdate:modelValue":o[5]||(o[5]=r=>e.form.password_confirmation=r),dense:"",outlined:"",type:e.showConfirm?"text":"password",label:"Confirmar nueva contrasena",autocomplete:"new-password",class:"q-mb-md",rules:[r=>!!r||"Requerido",r=>r===e.form.password||"No coincide"]},{append:a(()=>[s(i,{dense:"",flat:"",round:"",type:"button",icon:e.showConfirm?"visibility":"visibility_off",onClick:o[4]||(o[4]=r=>e.showConfirm=!e.showConfirm)},null,8,["icon"])]),_:1},8,["modelValue","type","rules"]),s(x,{dense:"",class:"bg-grey-1 q-mb-md",rounded:""},{default:a(()=>[...o[9]||(o[9]=[v(" Se guardara en password (encriptado) y en clave. Luego cerraras sesion por seguridad. ",-1)])]),_:1}),t("div",S,[t("div",z,[s(i,{class:"full-width","no-caps":"",color:"primary",icon:"save",label:"Cambiar contrasena",type:"submit",loading:e.loading},null,8,["loading"])]),t("div",B,[s(i,{class:"full-width","no-caps":"",flat:"",color:"grey-8",icon:"arrow_back",label:"Volver",onClick:o[6]||(o[6]=r=>n.$router.push("/")),disable:e.loading},null,8,["disable"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])]),s(y,{modelValue:e.confirmDialog,"onUpdate:modelValue":o[7]||(o[7]=r=>e.confirmDialog=r),persistent:""},{default:a(()=>[s(u,{style:{"min-width":"340px","max-width":"460px",width:"92vw"}},{default:a(()=>[s(l,{class:"row items-center q-pb-sm"},{default:a(()=>[s(p,{name:"lock_reset",color:"primary",size:"24px",class:"q-mr-sm"}),o[10]||(o[10]=t("div",{class:"text-subtitle1 text-weight-medium"},"Cambiar contrasena",-1))]),_:1}),s(l,{class:"q-pt-none"},{default:a(()=>[...o[11]||(o[11]=[t("div",{class:"text-body2 q-mb-sm"}," Estas por actualizar tu contrasena. ",-1),t("div",{class:"text-caption text-grey-7"}," Se guardara en password y clave. Despues se cerrara tu sesion para que vuelvas a entrar. ",-1)])]),_:1}),s(h,{align:"right"},{default:a(()=>[_(s(i,{flat:"","no-caps":"",label:"Cancelar",color:"grey-8",disable:e.loading},null,8,["disable"]),[[q]]),s(i,{unelevated:"","no-caps":"",label:"Confirmar cambio",color:"primary",loading:e.loading,onClick:m.submit},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const E=f(k,[["render",I]]);export{E as default};
